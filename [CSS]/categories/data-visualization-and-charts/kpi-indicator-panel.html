<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPI Indicator Panel - JaZeR CSS Patterns</title>
    <link rel="stylesheet" href="../../../jazer-brand.css">
    <style>
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-body);
            background: var(--bg-dark);
            color: var(--text-light);
            min-height: 100vh;
            padding: 1.5rem;
            line-height: 1.6;
        }

        /* Back Button */
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--jazer-cyan);
            text-decoration: none;
            font-family: var(--font-secondary);
            font-weight: 600;
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            border: 1px solid transparent;
            border-radius: 8px;
            transition: all 0.3s ease;
            margin-bottom: 1.5rem;
        }

        .back-button:hover {
            color: var(--jazer-pink);
            border-color: var(--jazer-pink);
            transform: translateX(-5px);
        }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: 2rem 1.5rem;
            margin-bottom: 2rem;
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.08) 0%, rgba(147, 51, 234, 0.08) 50%, rgba(236, 72, 153, 0.08) 100%);
            border-radius: 16px;
            border: 1px solid rgba(6, 182, 212, 0.2);
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gradient-primary);
        }

        .hero h1 {
            font-family: var(--font-primary);
            font-size: clamp(1.75rem, 4vw, 2.5rem);
            font-weight: 800;
            background: var(--gradient-text);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .hero-description {
            color: var(--text-gray);
            font-size: 1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Main Layout */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        @media (min-width: 1000px) {
            .main-grid {
                grid-template-columns: 1fr 340px;
            }
        }

        /* Panel Styling */
        .panel {
            background: var(--bg-card);
            border: 2px solid var(--border-default);
            border-radius: 16px;
            padding: 1.5rem;
            transition: border-color 0.3s ease;
        }

        .panel:hover {
            border-color: rgba(6, 182, 212, 0.3);
        }

        .panel-title {
            font-family: var(--font-secondary);
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--jazer-cyan);
            margin-bottom: 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .panel-title::before {
            content: '';
            width: 4px;
            height: 16px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }

        /* Demo Area */
        .demo-area {
            min-height: 500px;
        }

        /* Layout Tabs */
        .layout-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .layout-tab {
            padding: 0.6rem 1rem;
            font-size: 0.8rem;
            border-radius: 8px;
            border: 2px solid var(--border-default);
            background: transparent;
            color: var(--text-gray);
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: var(--font-secondary);
            font-weight: 600;
        }

        .layout-tab:hover {
            border-color: var(--jazer-purple);
            color: var(--text-light);
        }

        .layout-tab.active {
            border-color: var(--jazer-cyan);
            background: rgba(6, 182, 212, 0.15);
            color: var(--jazer-cyan);
        }

        /* KPI Grid */
        .kpi-grid {
            display: grid;
            gap: 1rem;
        }

        .kpi-grid.layout-grid {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        .kpi-grid.layout-row {
            grid-template-columns: repeat(4, 1fr);
        }

        .kpi-grid.layout-featured {
            grid-template-columns: 2fr 1fr 1fr;
            grid-template-rows: 1fr 1fr;
        }

        .kpi-grid.layout-featured .kpi-card:first-child {
            grid-row: span 2;
        }

        @media (max-width: 800px) {
            .kpi-grid.layout-row,
            .kpi-grid.layout-featured {
                grid-template-columns: 1fr 1fr;
            }
            .kpi-grid.layout-featured .kpi-card:first-child {
                grid-column: span 2;
                grid-row: span 1;
            }
        }

        @media (max-width: 500px) {
            .kpi-grid.layout-row,
            .kpi-grid.layout-featured {
                grid-template-columns: 1fr;
            }
            .kpi-grid.layout-featured .kpi-card:first-child {
                grid-column: span 1;
            }
        }

        /* KPI Card */
        .kpi-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-default);
            border-radius: 12px;
            padding: 1.25rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .kpi-card:hover {
            border-color: var(--jazer-cyan);
            transform: translateY(-2px);
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--kpi-color, var(--jazer-cyan));
            opacity: 0.8;
        }

        .kpi-card.status-success { --kpi-color: #10b981; }
        .kpi-card.status-warning { --kpi-color: #ffbe0b; }
        .kpi-card.status-danger { --kpi-color: #ef4444; }
        .kpi-card.status-info { --kpi-color: var(--jazer-cyan); }

        /* Card Header */
        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .kpi-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: var(--font-secondary);
            font-weight: 600;
        }

        .kpi-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            font-size: 1rem;
        }

        /* KPI Value */
        .kpi-value-row {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: 800;
            font-family: var(--font-primary);
            color: var(--text-light);
            line-height: 1;
        }

        .kpi-unit {
            font-size: 0.9rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        /* Trend Indicator */
        .kpi-trend {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.8rem;
            font-weight: 600;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .kpi-trend.up {
            color: #10b981;
            background: rgba(16, 185, 129, 0.15);
        }

        .kpi-trend.down {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.15);
        }

        .kpi-trend.neutral {
            color: var(--text-muted);
            background: rgba(255, 255, 255, 0.05);
        }

        /* Progress Bar */
        .kpi-progress {
            margin-top: 1rem;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-bottom: 0.35rem;
        }

        .progress-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 3px;
            background: var(--kpi-color, var(--jazer-cyan));
            transition: width 0.6s ease;
            box-shadow: 0 0 8px var(--kpi-color, var(--jazer-cyan));
        }

        /* Sparkline in Card */
        .kpi-sparkline {
            margin-top: 0.75rem;
            height: 40px;
        }

        .kpi-sparkline svg {
            width: 100%;
            height: 100%;
        }

        /* Status Badge */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            font-size: 0.7rem;
            font-weight: 600;
            padding: 0.25rem 0.6rem;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-badge.success {
            color: #10b981;
            background: rgba(16, 185, 129, 0.15);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-badge.warning {
            color: #ffbe0b;
            background: rgba(255, 190, 11, 0.15);
            border: 1px solid rgba(255, 190, 11, 0.3);
        }

        .status-badge.danger {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Featured Card Specific */
        .kpi-card.featured .kpi-value {
            font-size: 3rem;
        }

        .kpi-card.featured .kpi-sparkline {
            height: 80px;
        }

        /* Comparison Row */
        .kpi-comparison {
            display: flex;
            justify-content: space-between;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-default);
            font-size: 0.75rem;
        }

        .comparison-item {
            text-align: center;
        }

        .comparison-label {
            color: var(--text-muted);
            margin-bottom: 0.2rem;
        }

        .comparison-value {
            color: var(--text-light);
            font-weight: 600;
        }

        /* Controls Panel */
        .controls-panel {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* Accordion */
        details {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-default);
            border-radius: 10px;
            overflow: hidden;
        }

        details[open] {
            border-color: rgba(6, 182, 212, 0.3);
        }

        summary {
            padding: 0.875rem 1rem;
            cursor: pointer;
            font-family: var(--font-secondary);
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.2s ease;
            list-style: none;
        }

        summary::-webkit-details-marker {
            display: none;
        }

        summary::after {
            content: '+';
            font-size: 1.2rem;
            color: var(--jazer-cyan);
            transition: transform 0.2s ease;
        }

        details[open] summary::after {
            transform: rotate(45deg);
        }

        summary:hover {
            background: rgba(6, 182, 212, 0.05);
        }

        .details-content {
            padding: 1rem;
            border-top: 1px solid var(--border-default);
        }

        /* Control Groups */
        .control-group {
            margin-bottom: 1rem;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-label {
            display: block;
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
            font-family: var(--font-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Select Dropdown */
        select {
            width: 100%;
            padding: 0.6rem 0.875rem;
            font-size: 0.85rem;
            border-radius: 8px;
            border: 2px solid var(--border-default);
            background: rgba(0, 0, 0, 0.3);
            color: var(--text-light);
            cursor: pointer;
            font-family: var(--font-secondary);
            transition: border-color 0.2s ease;
        }

        select:hover, select:focus {
            border-color: var(--jazer-cyan);
            outline: none;
        }

        select option {
            background: #1a1a1a;
            color: var(--text-light);
        }

        /* Range Slider */
        .range-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            appearance: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--jazer-cyan);
            cursor: pointer;
            box-shadow: 0 0 8px rgba(6, 182, 212, 0.5);
            transition: transform 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .range-value {
            min-width: 50px;
            text-align: right;
            font-size: 0.85rem;
            color: var(--jazer-cyan);
            font-weight: 600;
            font-family: var(--font-secondary);
        }

        /* Toggle Switch */
        .toggle-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0;
        }

        .toggle-label {
            font-size: 0.85rem;
            color: var(--text-gray);
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            left: 3px;
            bottom: 3px;
            background: var(--text-gray);
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: rgba(6, 182, 212, 0.3);
        }

        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(20px);
            background: var(--jazer-cyan);
            box-shadow: 0 0 8px var(--jazer-cyan);
        }

        /* KPI Editor */
        .kpi-editor {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .kpi-editor-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            font-size: 0.8rem;
            color: var(--text-light);
            font-weight: 600;
        }

        .kpi-editor-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .kpi-editor input[type="text"],
        .kpi-editor input[type="number"] {
            width: 100%;
            padding: 0.4rem 0.6rem;
            font-size: 0.8rem;
            border-radius: 6px;
            border: 1px solid var(--border-default);
            background: rgba(0, 0, 0, 0.3);
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .kpi-editor input:focus {
            border-color: var(--jazer-cyan);
            outline: none;
        }

        .kpi-editor-row {
            display: flex;
            gap: 0.5rem;
        }

        .kpi-editor-row input {
            flex: 1;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .btn {
            flex: 1;
            padding: 0.7rem 1rem;
            font-size: 0.8rem;
            border-radius: 8px;
            border: 2px solid var(--border-default);
            background: transparent;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: var(--font-secondary);
            font-weight: 600;
        }

        .btn:hover {
            border-color: var(--jazer-purple);
            color: var(--jazer-purple);
        }

        .btn-primary {
            background: var(--gradient-accent);
            border-color: transparent;
        }

        .btn-primary:hover {
            filter: brightness(1.1);
            color: white;
        }

        /* Presets Section */
        .presets-section {
            margin-top: 1.5rem;
        }

        .presets-scroll {
            display: flex;
            gap: 0.75rem;
            overflow-x: auto;
            padding: 0.5rem 0;
            scrollbar-width: thin;
            scrollbar-color: var(--jazer-cyan) transparent;
        }

        .presets-scroll::-webkit-scrollbar {
            height: 6px;
        }

        .presets-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .presets-scroll::-webkit-scrollbar-thumb {
            background: var(--jazer-cyan);
            border-radius: 3px;
        }

        .preset-card {
            flex: 0 0 auto;
            width: 130px;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--border-default);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .preset-card:hover {
            border-color: var(--jazer-purple);
            transform: translateY(-4px);
        }

        .preset-card.active {
            border-color: var(--jazer-cyan);
            background: rgba(6, 182, 212, 0.1);
        }

        .preset-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .preset-name {
            font-size: 0.75rem;
            color: var(--text-gray);
            font-weight: 600;
        }

        /* Status Bar */
        .status-bar {
            background: var(--bg-card);
            border: 2px solid var(--border-default);
            border-radius: 12px;
            padding: 0.875rem 1.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        .status-info {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.75rem;
        }

        .status-item span:first-child {
            color: var(--text-muted);
            font-family: var(--font-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-item span:last-child {
            color: var(--jazer-cyan);
            font-weight: 600;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            color: var(--text-gray);
        }

        .status-dot-main {
            width: 8px;
            height: 8px;
            background: var(--jazer-cyan);
            border-radius: 50%;
            animation: statusPulse 2s ease-in-out infinite;
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 4px var(--jazer-cyan); }
            50% { opacity: 0.5; box-shadow: 0 0 8px var(--jazer-cyan); }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-button">‚Üê Back to Data Visualization & Charts</a>

    <header class="hero">
        <h1>KPI Indicator Panel</h1>
        <p class="hero-description">Key Performance Indicator cards with status indicators, trend visualization, progress bars, and threshold alerts for executive dashboards.</p>
    </header>

    <div class="main-grid">
        <!-- Demo Area -->
        <section class="panel demo-area">
            <div class="panel-title">Interactive Preview</div>
            
            <div class="layout-tabs">
                <button class="layout-tab active" data-layout="grid">Grid</button>
                <button class="layout-tab" data-layout="row">Row</button>
                <button class="layout-tab" data-layout="featured">Featured</button>
            </div>

            <div class="kpi-grid layout-grid" id="kpiGrid">
                <!-- Rendered by JS -->
            </div>
        </section>

        <!-- Controls Panel -->
        <aside class="controls-panel">
            <div class="panel">
                <div class="panel-title">Panel Configuration</div>

                <details open>
                    <summary>Display Options</summary>
                    <div class="details-content">
                        <div class="toggle-row">
                            <span class="toggle-label">Show Icons</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="showIcons" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="toggle-row">
                            <span class="toggle-label">Show Trends</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="showTrends" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="toggle-row">
                            <span class="toggle-label">Show Progress</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="showProgress" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="toggle-row">
                            <span class="toggle-label">Show Sparklines</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="showSparklines" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="toggle-row">
                            <span class="toggle-label">Show Status Badge</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="showStatus" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="toggle-row">
                            <span class="toggle-label">Show Comparison</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="showComparison">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </details>

                <details>
                    <summary>KPI Data</summary>
                    <div class="details-content" id="kpiEditors">
                        <!-- Generated by JS -->
                    </div>
                </details>

                <details>
                    <summary>Thresholds</summary>
                    <div class="details-content">
                        <div class="control-group">
                            <label class="control-label">Warning Threshold</label>
                            <div class="range-container">
                                <input type="range" id="warningThreshold" min="0" max="100" value="60">
                                <span class="range-value" id="warningThresholdDisplay">60%</span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">Danger Threshold</label>
                            <div class="range-container">
                                <input type="range" id="dangerThreshold" min="0" max="100" value="30">
                                <span class="range-value" id="dangerThresholdDisplay">30%</span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">Comparison Mode</label>
                            <select id="comparisonMode">
                                <option value="higher">Higher is Better</option>
                                <option value="lower">Lower is Better</option>
                            </select>
                        </div>
                    </div>
                </details>

                <div class="action-buttons">
                    <button class="btn" id="simulateBtn">Simulate</button>
                    <button class="btn btn-primary" id="resetBtn">Reset</button>
                </div>
            </div>
        </aside>
    </div>

    <!-- Presets Section -->
    <section class="presets-section">
        <div class="panel">
            <div class="panel-title">Quick Presets</div>
            <div class="presets-scroll" id="presetsScroll">
                <!-- Presets rendered by JS -->
            </div>
        </div>
    </section>

    <!-- Status Bar -->
    <footer class="status-bar">
        <div class="status-info">
            <div class="status-item">
                <span>Layout:</span>
                <span id="statusLayout">Grid</span>
            </div>
            <div class="status-item">
                <span>KPIs:</span>
                <span id="statusKpis">4</span>
            </div>
            <div class="status-item">
                <span>Healthy:</span>
                <span id="statusHealthy">3</span>
            </div>
            <div class="status-item">
                <span>Alerts:</span>
                <span id="statusAlerts">1</span>
            </div>
        </div>
        <div class="status-indicator">
            <span class="status-dot-main"></span>
            <span>Panel Active</span>
        </div>
    </footer>

    <script>
        // State
        const state = {
            layout: 'grid',
            showIcons: true,
            showTrends: true,
            showProgress: true,
            showSparklines: true,
            showStatus: true,
            showComparison: false,
            warningThreshold: 60,
            dangerThreshold: 30,
            comparisonMode: 'higher',
            kpis: [
                { id: 1, label: 'Revenue', value: 124500, unit: '$', target: 150000, trend: 12.5, icon: 'üí∞', history: [] },
                { id: 2, label: 'Users', value: 8432, unit: '', target: 10000, trend: 8.3, icon: 'üë•', history: [] },
                { id: 3, label: 'Conversion', value: 3.2, unit: '%', target: 5, trend: -2.1, icon: 'üìà', history: [] },
                { id: 4, label: 'Response Time', value: 245, unit: 'ms', target: 200, trend: -15.5, icon: '‚ö°', history: [] }
            ]
        };

        // Presets
        const presets = [
            { name: 'Sales Dashboard', icon: 'üí∞', kpis: [
                { label: 'Revenue', value: 124500, unit: '$', target: 150000, trend: 12.5, icon: 'üí∞' },
                { label: 'Orders', value: 1847, unit: '', target: 2000, trend: 5.2, icon: 'üì¶' },
                { label: 'Avg Order', value: 67.4, unit: '$', target: 75, trend: 3.1, icon: 'üõí' },
                { label: 'Returns', value: 2.1, unit: '%', target: 3, trend: -8.5, icon: '‚Ü©Ô∏è' }
            ]},
            { name: 'User Analytics', icon: 'üë•', kpis: [
                { label: 'Active Users', value: 15420, unit: '', target: 20000, trend: 18.3, icon: 'üë•' },
                { label: 'Sessions', value: 42890, unit: '', target: 50000, trend: 22.1, icon: 'üìä' },
                { label: 'Bounce Rate', value: 34.5, unit: '%', target: 30, trend: 5.2, icon: '‚ÜóÔ∏è' },
                { label: 'Avg Duration', value: 4.2, unit: 'min', target: 5, trend: -3.8, icon: '‚è±Ô∏è' }
            ]},
            { name: 'Server Health', icon: 'üñ•Ô∏è', kpis: [
                { label: 'Uptime', value: 99.9, unit: '%', target: 99.5, trend: 0.1, icon: 'üü¢' },
                { label: 'CPU Usage', value: 42, unit: '%', target: 80, trend: -5.2, icon: 'üíª' },
                { label: 'Memory', value: 68, unit: '%', target: 85, trend: 2.3, icon: 'üß†' },
                { label: 'Latency', value: 45, unit: 'ms', target: 100, trend: -12.5, icon: '‚ö°' }
            ]},
            { name: 'Marketing', icon: 'üì£', kpis: [
                { label: 'Impressions', value: 2.4, unit: 'M', target: 3, trend: 15.2, icon: 'üëÅÔ∏è' },
                { label: 'Clicks', value: 48200, unit: '', target: 60000, trend: 8.7, icon: 'üëÜ' },
                { label: 'CTR', value: 2.01, unit: '%', target: 2.5, trend: 4.3, icon: 'üìà' },
                { label: 'CPC', value: 0.45, unit: '$', target: 0.40, trend: -6.2, icon: 'üíµ' }
            ]},
            { name: 'Support', icon: 'üéß', kpis: [
                { label: 'Tickets', value: 234, unit: '', target: 200, trend: 12.5, icon: 'üé´' },
                { label: 'Resolved', value: 89, unit: '%', target: 95, trend: -3.2, icon: '‚úÖ' },
                { label: 'Avg Response', value: 2.4, unit: 'hrs', target: 2, trend: 8.5, icon: '‚è∞' },
                { label: 'Satisfaction', value: 4.2, unit: '/5', target: 4.5, trend: 5.1, icon: '‚≠ê' }
            ]},
            { name: 'E-commerce', icon: 'üõçÔ∏è', kpis: [
                { label: 'GMV', value: 89500, unit: '$', target: 100000, trend: 15.8, icon: 'üí∞' },
                { label: 'Products', value: 1250, unit: '', target: 1500, trend: 8.3, icon: 'üì¶' },
                { label: 'Cart Rate', value: 18.5, unit: '%', target: 25, trend: 2.1, icon: 'üõí' },
                { label: 'Checkout', value: 62, unit: '%', target: 70, trend: -1.5, icon: 'üí≥' }
            ]}
        ];

        // DOM Elements
        const kpiGrid = document.getElementById('kpiGrid');
        const layoutTabs = document.querySelectorAll('.layout-tab');
        const showIconsToggle = document.getElementById('showIcons');
        const showTrendsToggle = document.getElementById('showTrends');
        const showProgressToggle = document.getElementById('showProgress');
        const showSparklinesToggle = document.getElementById('showSparklines');
        const showStatusToggle = document.getElementById('showStatus');
        const showComparisonToggle = document.getElementById('showComparison');
        const warningSlider = document.getElementById('warningThreshold');
        const warningDisplay = document.getElementById('warningThresholdDisplay');
        const dangerSlider = document.getElementById('dangerThreshold');
        const dangerDisplay = document.getElementById('dangerThresholdDisplay');
        const comparisonModeSelect = document.getElementById('comparisonMode');
        const kpiEditors = document.getElementById('kpiEditors');
        const simulateBtn = document.getElementById('simulateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const presetsScroll = document.getElementById('presetsScroll');

        // Status elements
        const statusLayout = document.getElementById('statusLayout');
        const statusKpis = document.getElementById('statusKpis');
        const statusHealthy = document.getElementById('statusHealthy');
        const statusAlerts = document.getElementById('statusAlerts');

        // Generate sparkline data
        function generateHistory(baseValue, volatility = 10, points = 12) {
            const data = [];
            let value = baseValue;
            for (let i = 0; i < points; i++) {
                value = value + (Math.random() - 0.5) * volatility * 2;
                data.push(Math.max(0, value));
            }
            return data;
        }

        // Generate sparkline SVG
        function generateSparkline(data, color, width = 100, height = 40) {
            if (!data || data.length === 0) return '';
            
            const min = Math.min(...data);
            const max = Math.max(...data);
            const range = max - min || 1;
            
            const points = data.map((val, i) => {
                const x = (i / (data.length - 1)) * width;
                const y = height - ((val - min) / range) * height;
                return `${x},${y}`;
            }).join(' ');

            return `
                <svg viewBox="0 0 ${width} ${height}" preserveAspectRatio="none">
                    <polyline 
                        points="${points}" 
                        fill="none" 
                        stroke="${color}" 
                        stroke-width="2" 
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        style="filter: drop-shadow(0 0 3px ${color});"
                    />
                </svg>
            `;
        }

        // Get KPI status
        function getKpiStatus(kpi) {
            const progress = (kpi.value / kpi.target) * 100;
            const isHigherBetter = state.comparisonMode === 'higher';
            
            let effectiveProgress = isHigherBetter ? progress : (200 - progress);
            
            if (effectiveProgress >= 100) return 'success';
            if (effectiveProgress >= state.warningThreshold) return 'warning';
            return 'danger';
        }

        // Format value
        function formatValue(value, unit) {
            if (unit === '$') {
                if (value >= 1000000) return (value / 1000000).toFixed(1) + 'M';
                if (value >= 1000) return (value / 1000).toFixed(1) + 'K';
                return value.toLocaleString();
            }
            if (typeof value === 'number') {
                if (value >= 1000000) return (value / 1000000).toFixed(1) + 'M';
                if (value >= 1000) return (value / 1000).toFixed(1) + 'K';
                return value.toLocaleString();
            }
            return value;
        }

        // Render KPI card
        function renderKpiCard(kpi, index) {
            const status = getKpiStatus(kpi);
            const progress = Math.min(100, (kpi.value / kpi.target) * 100);
            const trendClass = kpi.trend >= 0 ? 'up' : 'down';
            const trendIcon = kpi.trend >= 0 ? '‚Üë' : '‚Üì';
            const isFeatured = state.layout === 'featured' && index === 0;
            const statusColor = status === 'success' ? '#10b981' : status === 'warning' ? '#ffbe0b' : '#ef4444';

            // Generate history if not exists
            if (!kpi.history || kpi.history.length === 0) {
                kpi.history = generateHistory(kpi.value, kpi.value * 0.1);
            }

            return `
                <div class="kpi-card status-${status} ${isFeatured ? 'featured' : ''}">
                    <div class="kpi-header">
                        <div>
                            <div class="kpi-label">${kpi.label}</div>
                            ${state.showStatus ? `
                                <span class="status-badge ${status}">
                                    <span class="status-dot"></span>
                                    ${status === 'success' ? 'On Track' : status === 'warning' ? 'At Risk' : 'Critical'}
                                </span>
                            ` : ''}
                        </div>
                        ${state.showIcons ? `<div class="kpi-icon">${kpi.icon}</div>` : ''}
                    </div>
                    
                    <div class="kpi-value-row">
                        ${kpi.unit === '$' ? '<span class="kpi-unit">$</span>' : ''}
                        <span class="kpi-value">${formatValue(kpi.value, kpi.unit)}</span>
                        ${kpi.unit && kpi.unit !== '$' ? `<span class="kpi-unit">${kpi.unit}</span>` : ''}
                    </div>

                    ${state.showTrends ? `
                        <div class="kpi-trend ${trendClass}">
                            ${trendIcon} ${Math.abs(kpi.trend).toFixed(1)}%
                        </div>
                    ` : ''}

                    ${state.showSparklines ? `
                        <div class="kpi-sparkline">
                            ${generateSparkline(kpi.history, statusColor, isFeatured ? 200 : 100, isFeatured ? 80 : 40)}
                        </div>
                    ` : ''}

                    ${state.showProgress ? `
                        <div class="kpi-progress">
                            <div class="progress-header">
                                <span>Progress</span>
                                <span>${progress.toFixed(0)}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                        </div>
                    ` : ''}

                    ${state.showComparison ? `
                        <div class="kpi-comparison">
                            <div class="comparison-item">
                                <div class="comparison-label">Target</div>
                                <div class="comparison-value">${formatValue(kpi.target, kpi.unit)}${kpi.unit && kpi.unit !== '$' ? kpi.unit : ''}</div>
                            </div>
                            <div class="comparison-item">
                                <div class="comparison-label">Prev Period</div>
                                <div class="comparison-value">${formatValue(kpi.value * (1 - kpi.trend / 100), kpi.unit)}${kpi.unit && kpi.unit !== '$' ? kpi.unit : ''}</div>
                            </div>
                            <div class="comparison-item">
                                <div class="comparison-label">Gap</div>
                                <div class="comparison-value" style="color: ${statusColor}">${(progress - 100).toFixed(0)}%</div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Render all KPIs
        function renderKpis() {
            kpiGrid.className = `kpi-grid layout-${state.layout}`;
            kpiGrid.innerHTML = state.kpis.map((kpi, index) => renderKpiCard(kpi, index)).join('');
        }

        // Render KPI editors
        function renderKpiEditors() {
            kpiEditors.innerHTML = state.kpis.map((kpi, index) => {
                const status = getKpiStatus(kpi);
                const statusColor = status === 'success' ? '#10b981' : status === 'warning' ? '#ffbe0b' : '#ef4444';
                
                return `
                    <div class="kpi-editor">
                        <div class="kpi-editor-header">
                            <span class="kpi-editor-color" style="background: ${statusColor}"></span>
                            ${kpi.label}
                        </div>
                        <input type="text" placeholder="Label" value="${kpi.label}" data-index="${index}" data-field="label">
                        <div class="kpi-editor-row">
                            <input type="number" placeholder="Value" value="${kpi.value}" data-index="${index}" data-field="value">
                            <input type="number" placeholder="Target" value="${kpi.target}" data-index="${index}" data-field="target">
                        </div>
                    </div>
                `;
            }).join('');

            // Add event listeners
            kpiEditors.querySelectorAll('input').forEach(input => {
                input.addEventListener('change', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    const field = e.target.dataset.field;
                    let value = e.target.value;
                    
                    if (field === 'value' || field === 'target') {
                        value = parseFloat(value);
                    }
                    
                    state.kpis[index][field] = value;
                    renderKpis();
                    updateStatus();
                });
            });
        }

        // Render presets
        function renderPresets() {
            presetsScroll.innerHTML = presets.map((preset, index) => `
                <div class="preset-card" data-index="${index}">
                    <div class="preset-icon">${preset.icon}</div>
                    <div class="preset-name">${preset.name}</div>
                </div>
            `).join('');
        }

        // Apply preset
        function applyPreset(index) {
            const preset = presets[index];
            state.kpis = preset.kpis.map((kpi, i) => ({
                id: i + 1,
                ...kpi,
                history: generateHistory(kpi.value, kpi.value * 0.1)
            }));

            document.querySelectorAll('.preset-card').forEach((card, i) => {
                card.classList.toggle('active', i === index);
            });

            renderKpiEditors();
            renderKpis();
            updateStatus();
        }

        // Update status
        function updateStatus() {
            statusLayout.textContent = state.layout.charAt(0).toUpperCase() + state.layout.slice(1);
            statusKpis.textContent = state.kpis.length;
            
            const healthy = state.kpis.filter(kpi => getKpiStatus(kpi) === 'success').length;
            const alerts = state.kpis.filter(kpi => getKpiStatus(kpi) === 'danger').length;
            
            statusHealthy.textContent = healthy;
            statusAlerts.textContent = alerts;
        }

        // Simulate data changes
        function simulateChanges() {
            state.kpis.forEach(kpi => {
                const change = (Math.random() - 0.5) * 0.2 * kpi.value;
                kpi.value = Math.max(0, kpi.value + change);
                kpi.trend = ((change / kpi.value) * 100);
                kpi.history.push(kpi.value);
                if (kpi.history.length > 12) kpi.history.shift();
            });
            
            renderKpis();
            updateStatus();
        }

        // Event Listeners
        layoutTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                layoutTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                state.layout = tab.dataset.layout;
                renderKpis();
                updateStatus();
            });
        });

        showIconsToggle.addEventListener('change', (e) => {
            state.showIcons = e.target.checked;
            renderKpis();
        });

        showTrendsToggle.addEventListener('change', (e) => {
            state.showTrends = e.target.checked;
            renderKpis();
        });

        showProgressToggle.addEventListener('change', (e) => {
            state.showProgress = e.target.checked;
            renderKpis();
        });

        showSparklinesToggle.addEventListener('change', (e) => {
            state.showSparklines = e.target.checked;
            renderKpis();
        });

        showStatusToggle.addEventListener('change', (e) => {
            state.showStatus = e.target.checked;
            renderKpis();
        });

        showComparisonToggle.addEventListener('change', (e) => {
            state.showComparison = e.target.checked;
            renderKpis();
        });

        warningSlider.addEventListener('input', (e) => {
            state.warningThreshold = parseInt(e.target.value);
            warningDisplay.textContent = state.warningThreshold + '%';
            renderKpis();
            updateStatus();
        });

        dangerSlider.addEventListener('input', (e) => {
            state.dangerThreshold = parseInt(e.target.value);
            dangerDisplay.textContent = state.dangerThreshold + '%';
            renderKpis();
            updateStatus();
        });

        comparisonModeSelect.addEventListener('change', (e) => {
            state.comparisonMode = e.target.value;
            renderKpis();
            updateStatus();
        });

        simulateBtn.addEventListener('click', simulateChanges);

        resetBtn.addEventListener('click', () => {
            state.layout = 'grid';
            state.showIcons = true;
            state.showTrends = true;
            state.showProgress = true;
            state.showSparklines = true;
            state.showStatus = true;
            state.showComparison = false;
            state.warningThreshold = 60;
            state.dangerThreshold = 30;
            state.comparisonMode = 'higher';
            state.kpis = [
                { id: 1, label: 'Revenue', value: 124500, unit: '$', target: 150000, trend: 12.5, icon: 'üí∞', history: [] },
                { id: 2, label: 'Users', value: 8432, unit: '', target: 10000, trend: 8.3, icon: 'üë•', history: [] },
                { id: 3, label: 'Conversion', value: 3.2, unit: '%', target: 5, trend: -2.1, icon: 'üìà', history: [] },
                { id: 4, label: 'Response Time', value: 245, unit: 'ms', target: 200, trend: -15.5, icon: '‚ö°', history: [] }
            ];

            // Update UI
            layoutTabs.forEach(t => t.classList.toggle('active', t.dataset.layout === 'grid'));
            showIconsToggle.checked = true;
            showTrendsToggle.checked = true;
            showProgressToggle.checked = true;
            showSparklinesToggle.checked = true;
            showStatusToggle.checked = true;
            showComparisonToggle.checked = false;
            warningSlider.value = 60;
            warningDisplay.textContent = '60%';
            dangerSlider.value = 30;
            dangerDisplay.textContent = '30%';
            comparisonModeSelect.value = 'higher';

            document.querySelectorAll('.preset-card').forEach(c => c.classList.remove('active'));

            renderKpiEditors();
            renderKpis();
            updateStatus();
        });

        presetsScroll.addEventListener('click', (e) => {
            const card = e.target.closest('.preset-card');
            if (card) {
                applyPreset(parseInt(card.dataset.index));
            }
        });

        // Initialize
        state.kpis.forEach(kpi => {
            kpi.history = generateHistory(kpi.value, kpi.value * 0.1);
        });
        renderPresets();
        renderKpiEditors();
        renderKpis();
        updateStatus();
    </script>
</body>
</html>
