<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pie Chart Animated - JaZeR CSS Patterns</title>
    <link rel="stylesheet" href="../../../jazer-brand.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background: var(--bg-dark);
            color: var(--text-light);
            min-height: 100vh;
            padding: 1.5rem;
            line-height: 1.6;
        }

        .page-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Back Button */
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-gray);
            text-decoration: none;
            font-family: var(--font-secondary);
            font-weight: 600;
            padding: 0.6rem 1.2rem;
            border-radius: 10px;
            border: 2px solid var(--border-default);
            background: var(--bg-card);
            transition: all 0.3s ease;
            margin-bottom: 1.5rem;
        }

        .back-button:hover {
            border-color: var(--jazer-cyan);
            color: var(--jazer-cyan);
            transform: translateX(-5px);
            box-shadow: var(--shadow-cyan);
        }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: 2rem 1.5rem;
            margin-bottom: 2rem;
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.08) 0%, rgba(147, 51, 234, 0.08) 50%, rgba(236, 72, 153, 0.08) 100%);
            border-radius: 16px;
            border: 1px solid rgba(6, 182, 212, 0.2);
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gradient-primary);
        }

        .hero h1 {
            font-family: var(--font-primary);
            font-size: clamp(1.75rem, 4vw, 2.5rem);
            font-weight: 800;
            background: var(--gradient-text);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .hero-description {
            color: var(--text-gray);
            font-size: 1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Preview Section */
        .preview-section {
            background: var(--bg-card);
            border: 2px solid var(--border-default);
            border-radius: 16px;
            padding: 1.5rem;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .preview-title {
            font-family: var(--font-secondary);
            font-weight: 700;
            font-size: 0.875rem;
            color: var(--jazer-cyan);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .preview-actions {
            display: flex;
            gap: 0.5rem;
        }

        .preview-actions button {
            padding: 0.4rem 0.8rem;
            font-size: 0.75rem;
            border-radius: 6px;
            border: 1px solid var(--border-default);
            background: var(--bg-card);
            color: var(--text-gray);
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: var(--font-secondary);
            font-weight: 600;
        }

        .preview-actions button:hover {
            border-color: var(--jazer-cyan);
            color: var(--jazer-cyan);
        }

        /* Chart Display */
        .chart-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            padding: 2rem;
            min-height: 400px;
        }

        /* Pie Chart Container */
        .pie-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pie-chart {
            position: relative;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .pie-chart:hover {
            transform: scale(1.02);
        }

        .pie-chart.size-small {
            width: 180px;
            height: 180px;
        }

        .pie-chart.size-medium {
            width: 250px;
            height: 250px;
        }

        .pie-chart.size-large {
            width: 320px;
            height: 320px;
        }

        .pie-chart.glow-on {
            filter: drop-shadow(0 0 20px rgba(6, 182, 212, 0.3));
        }

        /* Pie Slice Animation */
        @keyframes pieSliceIn {
            from {
                transform: scale(0) rotate(-90deg);
                opacity: 0;
            }
            to {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .pie-chart.animate {
            animation: pieSliceIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        /* Legend */
        .pie-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            max-width: 400px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: var(--bg-card);
            border: 1px solid var(--border-default);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .legend-item:hover {
            border-color: var(--jazer-cyan);
            transform: translateY(-2px);
        }

        .legend-item.highlighted {
            border-color: var(--jazer-cyan);
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.3);
        }

        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 4px;
        }

        .legend-label {
            font-size: 0.8rem;
            color: var(--text-light);
            font-family: var(--font-secondary);
        }

        .legend-value {
            font-size: 0.75rem;
            color: var(--jazer-cyan);
            font-weight: 700;
        }

        /* Center Label (for donut style) */
        .pie-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: none;
        }

        .pie-center-value {
            font-family: var(--font-secondary);
            font-size: 2rem;
            font-weight: 800;
            color: var(--text-light);
        }

        .pie-center-label {
            font-size: 0.75rem;
            color: var(--text-gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Tooltip */
        .pie-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid var(--jazer-cyan);
            border-radius: 8px;
            padding: 0.5rem 0.75rem;
            font-size: 0.8rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 100;
            white-space: nowrap;
        }

        .pie-tooltip.visible {
            opacity: 1;
        }

        /* Controls Panel */
        .controls-panel {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        details {
            background: var(--bg-card);
            border: 2px solid var(--border-default);
            border-radius: 12px;
            overflow: hidden;
            transition: border-color 0.3s ease;
        }

        details[open] {
            border-color: var(--jazer-cyan);
        }

        details summary {
            padding: 0.875rem 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: var(--font-secondary);
            font-weight: 700;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-light);
            list-style: none;
        }

        details summary::-webkit-details-marker {
            display: none;
        }

        details summary::after {
            content: '+';
            font-size: 1.25rem;
            color: var(--jazer-cyan);
            transition: transform 0.2s ease;
        }

        details[open] summary::after {
            transform: rotate(45deg);
        }

        details summary:hover {
            background: rgba(6, 182, 212, 0.05);
        }

        .details-content {
            padding: 0 1rem 1rem;
        }

        /* Data Editor */
        .data-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }

        .data-color {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: 2px solid var(--border-default);
            cursor: pointer;
        }

        .data-label {
            flex: 1;
            padding: 0.4rem;
            border: 1px solid var(--border-default);
            border-radius: 6px;
            background: var(--bg-dark);
            color: var(--text-light);
            font-size: 0.8rem;
        }

        .data-value {
            width: 60px;
            padding: 0.4rem;
            border: 1px solid var(--border-default);
            border-radius: 6px;
            background: var(--bg-dark);
            color: var(--jazer-cyan);
            font-size: 0.8rem;
            text-align: center;
            font-weight: 600;
        }

        .data-remove {
            width: 24px;
            height: 24px;
            border: none;
            background: rgba(255, 0, 110, 0.2);
            color: var(--jazer-pink);
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            line-height: 1;
        }

        .data-remove:hover {
            background: var(--jazer-pink);
            color: white;
        }

        .add-data-btn {
            width: 100%;
            padding: 0.6rem;
            border: 2px dashed var(--border-default);
            border-radius: 8px;
            background: transparent;
            color: var(--text-gray);
            cursor: pointer;
            font-family: var(--font-secondary);
            font-size: 0.75rem;
            transition: all 0.2s ease;
        }

        .add-data-btn:hover {
            border-color: var(--jazer-cyan);
            color: var(--jazer-cyan);
        }

        /* Size & Theme Grids */
        .option-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
        }

        .option-btn {
            padding: 0.6rem;
            border: 2px solid var(--border-default);
            border-radius: 8px;
            background: var(--bg-card);
            cursor: pointer;
            font-size: 0.7rem;
            color: var(--text-gray);
            font-family: var(--font-secondary);
            font-weight: 600;
            text-transform: uppercase;
            transition: all 0.2s ease;
        }

        .option-btn:hover {
            border-color: var(--jazer-purple);
            background: rgba(147, 51, 234, 0.1);
        }

        .option-btn.active {
            border-color: var(--jazer-cyan);
            background: rgba(6, 182, 212, 0.15);
            color: var(--jazer-cyan);
        }

        /* Toggle */
        .toggle-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0;
        }

        .toggle-label {
            font-size: 0.75rem;
            color: var(--text-gray);
            font-family: var(--font-secondary);
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--border-default);
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider::before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background: var(--text-gray);
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: var(--gradient-accent);
        }

        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(20px);
            background: white;
        }

        /* Presets Section */
        .presets-section {
            background: var(--bg-card);
            border: 2px solid var(--border-default);
            border-radius: 16px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .presets-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .presets-title {
            font-family: var(--font-secondary);
            font-weight: 700;
            font-size: 0.875rem;
            color: var(--jazer-pink);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .presets-scroll {
            display: flex;
            gap: 0.75rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .preset-card {
            flex: 0 0 auto;
            width: 130px;
            padding: 1rem 0.75rem;
            border: 2px solid var(--border-default);
            border-radius: 12px;
            background: rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .preset-card:hover {
            border-color: var(--jazer-purple);
            transform: translateY(-3px);
        }

        .preset-card.active {
            border-color: var(--jazer-pink);
            box-shadow: 0 0 15px rgba(255, 0, 110, 0.3);
        }

        .preset-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .preset-name {
            font-size: 0.7rem;
            color: var(--text-light);
            font-family: var(--font-secondary);
            font-weight: 600;
        }

        /* Status Bar */
        .status-bar {
            background: var(--bg-card);
            border: 2px solid var(--border-default);
            border-radius: 12px;
            padding: 0.875rem 1.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .status-info {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.75rem;
        }

        .status-item span:first-child {
            color: var(--text-muted);
            font-family: var(--font-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-item span:last-child {
            color: var(--jazer-cyan);
            font-weight: 600;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            color: var(--jazer-cyan);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--jazer-cyan);
            border-radius: 50%;
            animation: statusPulse 2s ease-in-out infinite;
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 4px var(--jazer-cyan); }
            50% { opacity: 0.5; box-shadow: 0 0 8px var(--jazer-cyan); }
        }

        @media (max-width: 600px) {
            .chart-display {
                padding: 1rem;
            }
            .pie-legend {
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <a href="index.html" class="back-button">‚Üê Back to Data Visualization</a>

        <header class="hero">
            <h1>Pie Chart Animated</h1>
            <p class="hero-description">Dynamic pie charts with smooth animations, interactive legends, and customizable data segments for visualizing proportional data.</p>
        </header>

        <div class="main-grid">
            <section class="preview-section">
                <div class="preview-header">
                    <span class="preview-title">Live Preview</span>
                    <div class="preview-actions">
                        <button id="resetBtn">Reset</button>
                        <button id="animateBtn">Replay</button>
                    </div>
                </div>
                <div class="chart-display">
                    <div class="pie-container">
                        <svg class="pie-chart size-medium glow-on animate" viewBox="0 0 100 100" id="pieChart">
                            <!-- Slices rendered by JS -->
                        </svg>
                        <div class="pie-tooltip" id="pieTooltip"></div>
                    </div>
                    <div class="pie-legend" id="pieLegend">
                        <!-- Legend items rendered by JS -->
                    </div>
                </div>
            </section>

            <aside class="controls-panel">
                <details open>
                    <summary>Data</summary>
                    <div class="details-content">
                        <div id="dataEditor">
                            <!-- Data rows rendered by JS -->
                        </div>
                        <button class="add-data-btn" id="addDataBtn">+ Add Segment</button>
                    </div>
                </details>

                <details>
                    <summary>Size</summary>
                    <div class="details-content">
                        <div class="option-grid" id="sizeGrid">
                            <button class="option-btn" data-size="small">Small</button>
                            <button class="option-btn active" data-size="medium">Medium</button>
                            <button class="option-btn" data-size="large">Large</button>
                        </div>
                    </div>
                </details>

                <details>
                    <summary>Style</summary>
                    <div class="details-content">
                        <div class="option-grid" id="styleGrid">
                            <button class="option-btn active" data-style="pie">Pie</button>
                            <button class="option-btn" data-style="donut">Donut</button>
                            <button class="option-btn" data-style="thin">Thin</button>
                        </div>
                    </div>
                </details>

                <details>
                    <summary>Options</summary>
                    <div class="details-content">
                        <div class="toggle-row">
                            <span class="toggle-label">Neon Glow</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="glowToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="toggle-row">
                            <span class="toggle-label">Show Legend</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="legendToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="toggle-row">
                            <span class="toggle-label">Animate</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="animateToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </details>
            </aside>
        </div>

        <section class="presets-section">
            <div class="presets-header">
                <span class="presets-title">Data Presets</span>
            </div>
            <div class="presets-scroll" id="presetsScroll"></div>
        </section>

        <footer class="status-bar">
            <div class="status-info">
                <div class="status-item">
                    <span>Segments:</span>
                    <span id="statusSegments">5</span>
                </div>
                <div class="status-item">
                    <span>Total:</span>
                    <span id="statusTotal">100</span>
                </div>
                <div class="status-item">
                    <span>Style:</span>
                    <span id="statusStyle">Pie</span>
                </div>
            </div>
            <div class="status-indicator">
                <span class="status-dot"></span>
                <span>Chart Ready</span>
            </div>
        </footer>
    </div>

    <script>
        // Default colors
        const colors = ['#00f2ea', '#9333ea', '#ff006e', '#ffbe0b', '#ff8800', '#10b981', '#4facfe', '#f472b6'];

        // State
        const state = {
            data: [
                { label: 'Product A', value: 35, color: '#00f2ea' },
                { label: 'Product B', value: 25, color: '#9333ea' },
                { label: 'Product C', value: 20, color: '#ff006e' },
                { label: 'Product D', value: 12, color: '#ffbe0b' },
                { label: 'Other', value: 8, color: '#ff8800' }
            ],
            size: 'medium',
            style: 'pie',
            glow: true,
            showLegend: true,
            animate: true
        };

        // Presets
        const presets = [
            { name: 'Market Share', icon: 'üìä', data: [
                { label: 'Leader', value: 42, color: '#00f2ea' },
                { label: 'Runner-up', value: 28, color: '#9333ea' },
                { label: 'Third', value: 18, color: '#ff006e' },
                { label: 'Others', value: 12, color: '#ffbe0b' }
            ]},
            { name: 'Budget', icon: 'üí∞', data: [
                { label: 'Rent', value: 30, color: '#ff006e' },
                { label: 'Food', value: 25, color: '#ffbe0b' },
                { label: 'Transport', value: 15, color: '#00f2ea' },
                { label: 'Utilities', value: 10, color: '#9333ea' },
                { label: 'Savings', value: 20, color: '#10b981' }
            ]},
            { name: 'Traffic Sources', icon: 'üåê', data: [
                { label: 'Organic', value: 45, color: '#10b981' },
                { label: 'Direct', value: 25, color: '#00f2ea' },
                { label: 'Social', value: 18, color: '#9333ea' },
                { label: 'Referral', value: 12, color: '#ff006e' }
            ]},
            { name: 'Device Usage', icon: 'üì±', data: [
                { label: 'Mobile', value: 55, color: '#00f2ea' },
                { label: 'Desktop', value: 35, color: '#9333ea' },
                { label: 'Tablet', value: 10, color: '#ff006e' }
            ]},
            { name: 'Age Groups', icon: 'üë•', data: [
                { label: '18-24', value: 20, color: '#00f2ea' },
                { label: '25-34', value: 35, color: '#9333ea' },
                { label: '35-44', value: 25, color: '#ff006e' },
                { label: '45-54', value: 12, color: '#ffbe0b' },
                { label: '55+', value: 8, color: '#ff8800' }
            ]},
            { name: 'Satisfaction', icon: '‚≠ê', data: [
                { label: 'Very Happy', value: 45, color: '#10b981' },
                { label: 'Happy', value: 30, color: '#00f2ea' },
                { label: 'Neutral', value: 15, color: '#ffbe0b' },
                { label: 'Unhappy', value: 10, color: '#ff006e' }
            ]}
        ];

        // DOM Elements
        const pieChart = document.getElementById('pieChart');
        const pieLegend = document.getElementById('pieLegend');
        const pieTooltip = document.getElementById('pieTooltip');
        const dataEditor = document.getElementById('dataEditor');
        const sizeGrid = document.getElementById('sizeGrid');
        const styleGrid = document.getElementById('styleGrid');
        const presetsScroll = document.getElementById('presetsScroll');

        // Calculate pie path
        function describeArc(x, y, radius, innerRadius, startAngle, endAngle) {
            const start = polarToCartesian(x, y, radius, endAngle);
            const end = polarToCartesian(x, y, radius, startAngle);
            const innerStart = polarToCartesian(x, y, innerRadius, endAngle);
            const innerEnd = polarToCartesian(x, y, innerRadius, startAngle);
            const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";

            if (innerRadius === 0) {
                return [
                    "M", start.x, start.y,
                    "A", radius, radius, 0, largeArcFlag, 0, end.x, end.y,
                    "L", x, y,
                    "Z"
                ].join(" ");
            } else {
                return [
                    "M", start.x, start.y,
                    "A", radius, radius, 0, largeArcFlag, 0, end.x, end.y,
                    "L", innerEnd.x, innerEnd.y,
                    "A", innerRadius, innerRadius, 0, largeArcFlag, 1, innerStart.x, innerStart.y,
                    "Z"
                ].join(" ");
            }
        }

        function polarToCartesian(cx, cy, radius, angleInDegrees) {
            const angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;
            return {
                x: cx + (radius * Math.cos(angleInRadians)),
                y: cy + (radius * Math.sin(angleInRadians))
            };
        }

        // Render pie chart
        function renderPie() {
            const total = state.data.reduce((sum, d) => sum + d.value, 0);
            let currentAngle = 0;
            
            const innerRadius = state.style === 'pie' ? 0 : state.style === 'donut' ? 25 : 35;
            const outerRadius = 45;

            pieChart.innerHTML = state.data.map((segment, i) => {
                const sliceAngle = (segment.value / total) * 360;
                const startAngle = currentAngle;
                const endAngle = currentAngle + sliceAngle;
                currentAngle = endAngle;

                const path = describeArc(50, 50, outerRadius, innerRadius, startAngle, endAngle - 0.5);
                
                return `<path 
                    d="${path}" 
                    fill="${segment.color}"
                    data-index="${i}"
                    data-label="${segment.label}"
                    data-value="${segment.value}"
                    data-percent="${((segment.value / total) * 100).toFixed(1)}"
                    style="cursor: pointer; transition: transform 0.2s, filter 0.2s; transform-origin: center;"
                />`;
            }).join('');

            // Update classes
            pieChart.className = `pie-chart size-${state.size}${state.glow ? ' glow-on' : ''}${state.animate ? ' animate' : ''}`;

            // Update legend
            if (state.showLegend) {
                pieLegend.style.display = 'flex';
                pieLegend.innerHTML = state.data.map((segment, i) => `
                    <div class="legend-item" data-index="${i}">
                        <div class="legend-color" style="background: ${segment.color};"></div>
                        <span class="legend-label">${segment.label}</span>
                        <span class="legend-value">${((segment.value / total) * 100).toFixed(1)}%</span>
                    </div>
                `).join('');
            } else {
                pieLegend.style.display = 'none';
            }

            updateStatus();
        }

        // Render data editor
        function renderDataEditor() {
            dataEditor.innerHTML = state.data.map((segment, i) => `
                <div class="data-row" data-index="${i}">
                    <input type="color" class="data-color" value="${segment.color}" data-field="color">
                    <input type="text" class="data-label" value="${segment.label}" data-field="label" placeholder="Label">
                    <input type="number" class="data-value" value="${segment.value}" data-field="value" min="1">
                    <button class="data-remove" title="Remove">√ó</button>
                </div>
            `).join('');
        }

        // Update status
        function updateStatus() {
            const total = state.data.reduce((sum, d) => sum + d.value, 0);
            document.getElementById('statusSegments').textContent = state.data.length;
            document.getElementById('statusTotal').textContent = total;
            document.getElementById('statusStyle').textContent = state.style.charAt(0).toUpperCase() + state.style.slice(1);
        }

        // Generate presets
        function generatePresets() {
            presetsScroll.innerHTML = presets.map((preset, i) => `
                <div class="preset-card" data-preset="${i}">
                    <div class="preset-icon">${preset.icon}</div>
                    <div class="preset-name">${preset.name}</div>
                </div>
            `).join('');
        }

        // Event: Pie hover
        pieChart.addEventListener('mousemove', (e) => {
            const path = e.target.closest('path');
            if (!path) {
                pieTooltip.classList.remove('visible');
                return;
            }
            
            pieTooltip.innerHTML = `<strong>${path.dataset.label}</strong>: ${path.dataset.value} (${path.dataset.percent}%)`;
            pieTooltip.style.left = (e.offsetX + 10) + 'px';
            pieTooltip.style.top = (e.offsetY - 30) + 'px';
            pieTooltip.classList.add('visible');
            
            path.style.filter = 'brightness(1.2)';
            path.style.transform = 'scale(1.03)';
        });

        pieChart.addEventListener('mouseleave', () => {
            pieTooltip.classList.remove('visible');
            pieChart.querySelectorAll('path').forEach(p => {
                p.style.filter = '';
                p.style.transform = '';
            });
        });

        // Event: Legend hover
        pieLegend.addEventListener('mouseover', (e) => {
            const item = e.target.closest('.legend-item');
            if (!item) return;
            const index = item.dataset.index;
            const path = pieChart.querySelector(`path[data-index="${index}"]`);
            if (path) {
                path.style.filter = 'brightness(1.2)';
                path.style.transform = 'scale(1.05)';
            }
            item.classList.add('highlighted');
        });

        pieLegend.addEventListener('mouseout', (e) => {
            const item = e.target.closest('.legend-item');
            if (!item) return;
            const index = item.dataset.index;
            const path = pieChart.querySelector(`path[data-index="${index}"]`);
            if (path) {
                path.style.filter = '';
                path.style.transform = '';
            }
            item.classList.remove('highlighted');
        });

        // Event: Data editor changes
        dataEditor.addEventListener('input', (e) => {
            const row = e.target.closest('.data-row');
            if (!row) return;
            const index = parseInt(row.dataset.index);
            const field = e.target.dataset.field;
            
            if (field === 'value') {
                state.data[index].value = Math.max(1, parseInt(e.target.value) || 1);
            } else if (field === 'label') {
                state.data[index].label = e.target.value;
            } else if (field === 'color') {
                state.data[index].color = e.target.value;
            }
            
            state.animate = false;
            renderPie();
        });

        // Event: Remove data
        dataEditor.addEventListener('click', (e) => {
            if (!e.target.classList.contains('data-remove')) return;
            if (state.data.length <= 2) return; // Minimum 2 segments
            
            const row = e.target.closest('.data-row');
            const index = parseInt(row.dataset.index);
            state.data.splice(index, 1);
            
            renderDataEditor();
            state.animate = true;
            renderPie();
        });

        // Event: Add data
        document.getElementById('addDataBtn').addEventListener('click', () => {
            if (state.data.length >= 8) return; // Maximum 8 segments
            
            state.data.push({
                label: `Segment ${state.data.length + 1}`,
                value: 10,
                color: colors[state.data.length % colors.length]
            });
            
            renderDataEditor();
            state.animate = true;
            renderPie();
        });

        // Event: Size selection
        sizeGrid.addEventListener('click', (e) => {
            const btn = e.target.closest('.option-btn');
            if (!btn) return;
            sizeGrid.querySelectorAll('.option-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            state.size = btn.dataset.size;
            renderPie();
        });

        // Event: Style selection
        styleGrid.addEventListener('click', (e) => {
            const btn = e.target.closest('.option-btn');
            if (!btn) return;
            styleGrid.querySelectorAll('.option-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            state.style = btn.dataset.style;
            state.animate = true;
            renderPie();
        });

        // Event: Toggles
        document.getElementById('glowToggle').addEventListener('change', (e) => {
            state.glow = e.target.checked;
            renderPie();
        });

        document.getElementById('legendToggle').addEventListener('change', (e) => {
            state.showLegend = e.target.checked;
            renderPie();
        });

        document.getElementById('animateToggle').addEventListener('change', (e) => {
            state.animate = e.target.checked;
        });

        // Event: Presets
        presetsScroll.addEventListener('click', (e) => {
            const card = e.target.closest('.preset-card');
            if (!card) return;
            
            const preset = presets[parseInt(card.dataset.preset)];
            state.data = JSON.parse(JSON.stringify(preset.data));
            
            presetsScroll.querySelectorAll('.preset-card').forEach(c => c.classList.remove('active'));
            card.classList.add('active');
            
            renderDataEditor();
            state.animate = true;
            renderPie();
        });

        // Event: Reset
        document.getElementById('resetBtn').addEventListener('click', () => {
            state.data = [
                { label: 'Product A', value: 35, color: '#00f2ea' },
                { label: 'Product B', value: 25, color: '#9333ea' },
                { label: 'Product C', value: 20, color: '#ff006e' },
                { label: 'Product D', value: 12, color: '#ffbe0b' },
                { label: 'Other', value: 8, color: '#ff8800' }
            ];
            state.size = 'medium';
            state.style = 'pie';
            state.glow = true;
            state.showLegend = true;
            
            sizeGrid.querySelectorAll('.option-btn').forEach(b => b.classList.toggle('active', b.dataset.size === 'medium'));
            styleGrid.querySelectorAll('.option-btn').forEach(b => b.classList.toggle('active', b.dataset.style === 'pie'));
            document.getElementById('glowToggle').checked = true;
            document.getElementById('legendToggle').checked = true;
            presetsScroll.querySelectorAll('.preset-card').forEach(c => c.classList.remove('active'));
            
            renderDataEditor();
            state.animate = true;
            renderPie();
        });

        // Event: Replay animation
        document.getElementById('animateBtn').addEventListener('click', () => {
            pieChart.classList.remove('animate');
            void pieChart.offsetWidth; // Trigger reflow
            pieChart.classList.add('animate');
        });

        // Initialize
        generatePresets();
        renderDataEditor();
        renderPie();
    </script>
</body>
</html>
