<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission Failed Screen Cracks</title>
    <link rel="stylesheet" href="../../../jazer-brand.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: var(--font-body); 
            background: var(--bg-dark); 
            color: var(--text-light); 
            padding: 2rem;
            min-height: 100vh;
        }
        
        h1 { 
            background: var(--gradient-text); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            margin-bottom: 0.5rem; 
            font-size: 2.5rem; 
        }
        
        .subtitle {
            color: var(--text-muted);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }
        
        .back-button { 
            display: inline-block; 
            color: var(--jazer-cyan); 
            text-decoration: none; 
            font-weight: 600; 
            padding: 0.75rem 1.5rem; 
            border-radius: 12px; 
            border: 2px solid var(--jazer-cyan); 
            background: rgba(6, 182, 212, 0.1); 
            margin-bottom: 2rem; 
            transition: all 0.3s ease; 
        }
        
        .back-button:hover { 
            background: var(--jazer-cyan); 
            color: var(--bg-dark); 
            transform: translateX(-5px); 
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.5); 
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .control-group label {
            font-size: 0.85rem;
            color: var(--jazer-cyan);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .control-group select,
        .control-group input {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid var(--jazer-purple);
            color: var(--text-light);
            padding: 0.6rem 1rem;
            border-radius: 8px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 160px;
        }
        
        .control-group select:hover,
        .control-group input:hover {
            border-color: var(--jazer-cyan);
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.3);
        }
        
        .trigger-btn {
            background: linear-gradient(135deg, #ff006e, #ff4444);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(255, 0, 110, 0.4);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        
        .trigger-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 0, 110, 0.6);
        }
        
        .reset-btn {
            background: linear-gradient(135deg, var(--jazer-cyan), var(--jazer-purple));
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(6, 182, 212, 0.3);
        }
        
        .reset-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(6, 182, 212, 0.5);
        }
        
        .demo-container {
            position: relative;
            border: 2px solid var(--jazer-pink);
            border-radius: 16px;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(15, 15, 35, 0.9), rgba(30, 20, 50, 0.9));
            min-height: 500px;
        }
        
        /* Screen content behind cracks */
        .screen-content {
            position: relative;
            width: 100%;
            height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 1.5rem;
            padding: 2rem;
            z-index: 1;
        }
        
        .game-scene {
            position: relative;
            width: 300px;
            height: 200px;
            background: linear-gradient(180deg, #1a0a2e 0%, #2d1b4e 50%, #1a0a2e 100%);
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid var(--jazer-purple);
        }
        
        .game-character {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3rem;
            transition: all 0.3s ease;
        }
        
        .game-character.defeated {
            transform: translateX(-50%) rotate(90deg);
            opacity: 0.5;
            filter: grayscale(1);
        }
        
        .game-enemy {
            position: absolute;
            top: 30px;
            right: 30px;
            font-size: 2.5rem;
        }
        
        .game-ground {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: linear-gradient(0deg, #2d1b4e, transparent);
        }
        
        .mission-text {
            font-size: 2.5rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .mission-text.visible {
            opacity: 1;
            transform: scale(1);
        }
        
        .mission-text.failed {
            color: #ff4444;
            text-shadow: 0 0 20px #ff4444, 0 0 40px #ff0000, 0 0 60px #ff0000;
        }
        
        .retry-button {
            background: rgba(255, 68, 68, 0.2);
            border: 2px solid #ff4444;
            color: #ff4444;
            padding: 1rem 3rem;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease;
        }
        
        .retry-button.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .retry-button:hover {
            background: #ff4444;
            color: white;
            box-shadow: 0 0 30px rgba(255, 68, 68, 0.5);
        }
        
        /* Crack Overlay */
        .crack-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.1s ease;
        }
        
        .crack-overlay.active {
            opacity: 1;
        }
        
        /* SVG Crack patterns */
        .crack-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .crack-line {
            fill: none;
            stroke: rgba(255, 255, 255, 0.9);
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            filter: drop-shadow(0 0 3px white) drop-shadow(0 0 6px rgba(255,255,255,0.5));
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
        }
        
        .crack-overlay.active .crack-line {
            animation: crackDraw 0.3s ease-out forwards;
        }
        
        @keyframes crackDraw {
            to { stroke-dashoffset: 0; }
        }
        
        /* Glass shards */
        .glass-shard {
            position: absolute;
            background: linear-gradient(135deg, 
                rgba(255,255,255,0.3), 
                rgba(255,255,255,0.1),
                rgba(255,255,255,0.2));
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
            opacity: 0;
            transform-origin: center;
        }
        
        .crack-overlay.active .glass-shard {
            animation: shardFall 1.5s ease-in forwards;
        }
        
        @keyframes shardFall {
            0% { 
                opacity: 0.8; 
                transform: translate(0, 0) rotate(0deg); 
            }
            100% { 
                opacity: 0; 
                transform: translate(var(--fall-x, 50px), var(--fall-y, 200px)) rotate(var(--fall-rot, 180deg)); 
            }
        }
        
        /* Screen flash */
        .screen-flash {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            opacity: 0;
            z-index: 5;
            pointer-events: none;
        }
        
        .screen-flash.active {
            animation: flashBang 0.3s ease-out;
        }
        
        @keyframes flashBang {
            0% { opacity: 0.8; }
            100% { opacity: 0; }
        }
        
        /* Red vignette */
        .damage-vignette {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at center, transparent 30%, rgba(255, 0, 0, 0.6) 100%);
            opacity: 0;
            z-index: 4;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .damage-vignette.active {
            opacity: 1;
        }
        
        /* Screen shake */
        @keyframes screenShake {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            10% { transform: translate(-10px, -5px) rotate(-1deg); }
            20% { transform: translate(10px, 5px) rotate(1deg); }
            30% { transform: translate(-8px, 3px) rotate(-0.5deg); }
            40% { transform: translate(8px, -3px) rotate(0.5deg); }
            50% { transform: translate(-5px, 2px) rotate(-0.3deg); }
            60% { transform: translate(5px, -2px) rotate(0.3deg); }
            70% { transform: translate(-3px, 1px) rotate(-0.1deg); }
            80% { transform: translate(3px, -1px) rotate(0.1deg); }
            90% { transform: translate(-1px, 1px) rotate(0deg); }
        }
        
        .demo-container.shaking {
            animation: screenShake 0.5s ease-out;
        }
        
        /* Impact point */
        .impact-point {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
            transform: translate(-50%, -50%) scale(0);
            opacity: 0;
            z-index: 15;
            pointer-events: none;
        }
        
        .impact-point.active {
            animation: impactBurst 0.4s ease-out forwards;
        }
        
        @keyframes impactBurst {
            0% { 
                transform: translate(-50%, -50%) scale(0); 
                opacity: 1; 
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.5); 
                opacity: 0.6; 
            }
            100% { 
                transform: translate(-50%, -50%) scale(2); 
                opacity: 0; 
            }
        }
        
        /* Crack style variations */
        
        /* Spider web crack */
        .crack-overlay.spider .crack-line {
            stroke: rgba(255, 255, 255, 0.85);
        }
        
        /* Shatter crack */
        .crack-overlay.shatter .crack-line {
            stroke: rgba(200, 220, 255, 0.9);
            stroke-width: 1.5;
            filter: drop-shadow(0 0 2px #88ccff) drop-shadow(0 0 5px rgba(136, 204, 255, 0.5));
        }
        
        /* Impact crack */
        .crack-overlay.impact .crack-line {
            stroke: rgba(255, 100, 100, 0.9);
            stroke-width: 2.5;
            filter: drop-shadow(0 0 4px #ff4444) drop-shadow(0 0 8px rgba(255, 68, 68, 0.5));
        }
        
        /* Frost crack */
        .crack-overlay.frost .crack-line {
            stroke: rgba(150, 220, 255, 0.9);
            stroke-width: 1.5;
            filter: drop-shadow(0 0 3px #66ddff) drop-shadow(0 0 6px rgba(102, 221, 255, 0.6));
        }
        
        .crack-overlay.frost {
            background: linear-gradient(135deg, 
                rgba(150, 220, 255, 0.1) 0%, 
                transparent 50%, 
                rgba(150, 220, 255, 0.1) 100%);
        }
        
        /* Glitch crack */
        .crack-overlay.glitch .crack-line {
            stroke: var(--jazer-cyan);
            stroke-width: 2;
            filter: drop-shadow(0 0 3px var(--jazer-cyan));
        }
        
        .crack-overlay.glitch.active {
            animation: glitchOverlay 0.5s steps(3) forwards;
        }
        
        @keyframes glitchOverlay {
            0%, 100% { 
                filter: none; 
            }
            25% { 
                filter: hue-rotate(90deg); 
                transform: translate(2px, 0); 
            }
            50% { 
                filter: hue-rotate(180deg); 
                transform: translate(-2px, 0); 
            }
            75% { 
                filter: hue-rotate(270deg); 
                transform: translate(1px, 0); 
            }
        }
        
        /* Neon crack */
        .crack-overlay.neon .crack-line {
            stroke: var(--jazer-pink);
            stroke-width: 2;
            filter: drop-shadow(0 0 5px var(--jazer-pink)) 
                    drop-shadow(0 0 10px var(--jazer-pink)) 
                    drop-shadow(0 0 20px var(--jazer-pink));
        }
        
        /* Intensity levels */
        .crack-overlay.intensity-light .crack-line {
            opacity: 0.6;
        }
        
        .crack-overlay.intensity-heavy .crack-line {
            stroke-width: 3;
        }
        
        /* Debris particles */
        .debris-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            pointer-events: none;
            z-index: 12;
        }
        
        .debris {
            position: absolute;
            background: linear-gradient(135deg, rgba(255,255,255,0.8), rgba(200,200,200,0.4));
            opacity: 0;
        }
        
        .debris.active {
            animation: debrisFall 1.2s ease-in forwards;
        }
        
        @keyframes debrisFall {
            0% {
                opacity: 1;
                transform: translate(0, 0) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translate(var(--debris-x, 0), var(--debris-y, 300px)) rotate(var(--debris-rot, 360deg));
            }
        }
        
        /* Showcase grid */
        .showcase-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .showcase-item {
            position: relative;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--jazer-purple);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            height: 150px;
        }
        
        .showcase-item:hover {
            border-color: var(--jazer-cyan);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(6, 182, 212, 0.3);
        }
        
        .showcase-item h3 {
            color: var(--jazer-pink);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        
        .showcase-preview {
            position: relative;
            width: 100%;
            height: 80px;
            background: linear-gradient(135deg, #1a0a2e, #2d1b4e);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .mini-crack {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
        }
        
        .keyboard-hint {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--jazer-purple);
            padding: 0.75rem 1.25rem;
            border-radius: 8px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        
        .keyboard-hint kbd {
            background: var(--jazer-purple);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-family: var(--font-primary);
            margin: 0 0.25rem;
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 1.8rem; }
            .controls { flex-direction: column; align-items: stretch; }
            .control-group select,
            .control-group input { min-width: 100%; }
            .screen-content { height: 400px; }
            .game-scene { width: 250px; height: 160px; }
            .mission-text { font-size: 1.8rem; }
            .keyboard-hint { display: none; }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-button">‚Üê Back</a>
    <h1>Mission Failed Screen Cracks</h1>
    <p class="subtitle">Dramatic screen crack effects for game failure states</p>
    
    <div class="controls">
        <div class="control-group">
            <label>Crack Style</label>
            <select id="crackStyle">
                <option value="spider">Spider Web</option>
                <option value="shatter">Shatter</option>
                <option value="impact">Impact</option>
                <option value="frost">Frost</option>
                <option value="glitch">Glitch</option>
                <option value="neon">Neon</option>
            </select>
        </div>
        <div class="control-group">
            <label>Intensity</label>
            <select id="intensity">
                <option value="light">Light</option>
                <option value="medium" selected>Medium</option>
                <option value="heavy">Heavy</option>
            </select>
        </div>
        <div class="control-group">
            <label>Impact Point</label>
            <select id="impactPoint">
                <option value="center">Center</option>
                <option value="random">Random</option>
                <option value="top">Top</option>
                <option value="bottom">Bottom</option>
            </select>
        </div>
        <button class="trigger-btn" onclick="triggerFailure()">Trigger Failure</button>
        <button class="reset-btn" onclick="resetScreen()">Reset</button>
    </div>
    
    <div class="demo-container" id="demoContainer">
        <div class="screen-flash" id="screenFlash"></div>
        <div class="damage-vignette" id="damageVignette"></div>
        
        <div class="screen-content">
            <div class="game-scene">
                <div class="game-character" id="gameCharacter">ü§ñ</div>
                <div class="game-enemy">üëæ</div>
                <div class="game-ground"></div>
            </div>
            <div class="mission-text" id="missionText">MISSION FAILED</div>
            <button class="retry-button" id="retryButton" onclick="resetScreen()">Try Again</button>
        </div>
        
        <div class="crack-overlay" id="crackOverlay">
            <svg class="crack-svg" id="crackSvg" viewBox="0 0 800 500" preserveAspectRatio="none"></svg>
        </div>
        
        <div class="impact-point" id="impactPoint"></div>
        <div class="debris-container" id="debrisContainer"></div>
    </div>
    
    <div class="showcase-grid">
        <div class="showcase-item" onclick="setStyleAndTrigger('spider')">
            <h3>Spider Web</h3>
            <div class="showcase-preview">
                <svg class="mini-crack" viewBox="0 0 60 60">
                    <path d="M30 30 L30 5 M30 30 L50 10 M30 30 L55 30 M30 30 L50 50 M30 30 L30 55 M30 30 L10 50 M30 30 L5 30 M30 30 L10 10" stroke="white" stroke-width="1.5" fill="none"/>
                </svg>
            </div>
        </div>
        <div class="showcase-item" onclick="setStyleAndTrigger('shatter')">
            <h3>Shatter</h3>
            <div class="showcase-preview">
                <svg class="mini-crack" viewBox="0 0 60 60">
                    <path d="M30 30 L15 5 L35 15 L55 5 M30 30 L55 25 L50 45 L55 55 M30 30 L35 55 L20 50 L5 55 M30 30 L5 35 L10 15 L5 5" stroke="#88ccff" stroke-width="1" fill="none"/>
                </svg>
            </div>
        </div>
        <div class="showcase-item" onclick="setStyleAndTrigger('impact')">
            <h3>Impact</h3>
            <div class="showcase-preview">
                <svg class="mini-crack" viewBox="0 0 60 60">
                    <circle cx="30" cy="30" r="8" stroke="#ff4444" stroke-width="2" fill="none"/>
                    <path d="M30 22 L30 5 M38 30 L55 30 M30 38 L30 55 M22 30 L5 30" stroke="#ff4444" stroke-width="2" fill="none"/>
                </svg>
            </div>
        </div>
        <div class="showcase-item" onclick="setStyleAndTrigger('frost')">
            <h3>Frost</h3>
            <div class="showcase-preview" style="background: linear-gradient(135deg, #1a2a3e, #2d3b4e);">
                <svg class="mini-crack" viewBox="0 0 60 60">
                    <path d="M30 5 L30 55 M5 30 L55 30 M12 12 L48 48 M12 48 L48 12" stroke="#66ddff" stroke-width="1" fill="none" stroke-dasharray="3,3"/>
                </svg>
            </div>
        </div>
        <div class="showcase-item" onclick="setStyleAndTrigger('glitch')">
            <h3>Glitch</h3>
            <div class="showcase-preview">
                <svg class="mini-crack" viewBox="0 0 60 60">
                    <path d="M5 20 L55 20 M5 30 L55 30 M5 40 L55 40" stroke="var(--jazer-cyan)" stroke-width="2" fill="none"/>
                    <rect x="15" y="15" width="10" height="30" fill="rgba(0,242,234,0.3)"/>
                    <rect x="35" y="20" width="15" height="20" fill="rgba(147,51,234,0.3)"/>
                </svg>
            </div>
        </div>
        <div class="showcase-item" onclick="setStyleAndTrigger('neon')">
            <h3>Neon</h3>
            <div class="showcase-preview">
                <svg class="mini-crack" viewBox="0 0 60 60">
                    <path d="M10 30 Q30 10 50 30 Q30 50 10 30" stroke="var(--jazer-pink)" stroke-width="2" fill="none" style="filter: drop-shadow(0 0 3px var(--jazer-pink))"/>
                </svg>
            </div>
        </div>
    </div>
    
    <div class="keyboard-hint">
        Press <kbd>Space</kbd> to trigger failure
    </div>
    
    <script>
        let isAnimating = false;
        let isFailed = false;
        
        // Crack pattern generators
        const crackPatterns = {
            spider: (cx, cy, intensity) => {
                const paths = [];
                const numRays = intensity === 'heavy' ? 12 : intensity === 'light' ? 6 : 8;
                const length = intensity === 'heavy' ? 250 : intensity === 'light' ? 150 : 200;
                
                for (let i = 0; i < numRays; i++) {
                    const angle = (i / numRays) * Math.PI * 2;
                    let path = `M${cx} ${cy}`;
                    let x = cx, y = cy;
                    const segments = 5 + Math.floor(Math.random() * 3);
                    
                    for (let j = 0; j < segments; j++) {
                        const segLength = (length / segments) * (0.8 + Math.random() * 0.4);
                        const deviation = (Math.random() - 0.5) * 0.5;
                        const newAngle = angle + deviation;
                        x += Math.cos(newAngle) * segLength;
                        y += Math.sin(newAngle) * segLength;
                        path += ` L${x} ${y}`;
                        
                        // Add branches
                        if (Math.random() > 0.6 && j > 0) {
                            const branchAngle = newAngle + (Math.random() > 0.5 ? 0.5 : -0.5);
                            const branchLength = segLength * 0.6;
                            const bx = x + Math.cos(branchAngle) * branchLength;
                            const by = y + Math.sin(branchAngle) * branchLength;
                            paths.push(`M${x} ${y} L${bx} ${by}`);
                        }
                    }
                    paths.push(path);
                }
                
                // Add circular cracks
                if (intensity !== 'light') {
                    const rings = intensity === 'heavy' ? 3 : 2;
                    for (let r = 1; r <= rings; r++) {
                        const radius = 40 * r;
                        paths.push(`M${cx - radius} ${cy} A${radius} ${radius} 0 1 1 ${cx + radius} ${cy} A${radius} ${radius} 0 1 1 ${cx - radius} ${cy}`);
                    }
                }
                
                return paths;
            },
            
            shatter: (cx, cy, intensity) => {
                const paths = [];
                const numShards = intensity === 'heavy' ? 20 : intensity === 'light' ? 8 : 14;
                
                for (let i = 0; i < numShards; i++) {
                    const angle1 = Math.random() * Math.PI * 2;
                    const angle2 = angle1 + 0.3 + Math.random() * 0.5;
                    const dist = 100 + Math.random() * 200;
                    
                    const x1 = cx + Math.cos(angle1) * dist;
                    const y1 = cy + Math.sin(angle1) * dist;
                    const x2 = cx + Math.cos(angle2) * dist;
                    const y2 = cy + Math.sin(angle2) * dist;
                    
                    paths.push(`M${cx} ${cy} L${x1} ${y1}`);
                    paths.push(`M${cx} ${cy} L${x2} ${y2}`);
                    paths.push(`M${x1} ${y1} L${x2} ${y2}`);
                }
                
                return paths;
            },
            
            impact: (cx, cy, intensity) => {
                const paths = [];
                const numRings = intensity === 'heavy' ? 5 : intensity === 'light' ? 2 : 3;
                
                // Concentric broken circles
                for (let r = 1; r <= numRings; r++) {
                    const radius = 30 * r;
                    const segments = 8;
                    for (let s = 0; s < segments; s++) {
                        if (Math.random() > 0.3) {
                            const startAngle = (s / segments) * Math.PI * 2;
                            const endAngle = ((s + 0.7) / segments) * Math.PI * 2;
                            const x1 = cx + Math.cos(startAngle) * radius;
                            const y1 = cy + Math.sin(startAngle) * radius;
                            const x2 = cx + Math.cos(endAngle) * radius;
                            const y2 = cy + Math.sin(endAngle) * radius;
                            paths.push(`M${x1} ${y1} A${radius} ${radius} 0 0 1 ${x2} ${y2}`);
                        }
                    }
                }
                
                // Radial cracks
                const numRays = intensity === 'heavy' ? 16 : intensity === 'light' ? 6 : 10;
                for (let i = 0; i < numRays; i++) {
                    const angle = (i / numRays) * Math.PI * 2 + Math.random() * 0.2;
                    const length = 100 + Math.random() * 150;
                    const x = cx + Math.cos(angle) * length;
                    const y = cy + Math.sin(angle) * length;
                    paths.push(`M${cx} ${cy} L${x} ${y}`);
                }
                
                return paths;
            },
            
            frost: (cx, cy, intensity) => {
                const paths = [];
                const numCrystals = intensity === 'heavy' ? 8 : intensity === 'light' ? 4 : 6;
                
                for (let i = 0; i < numCrystals; i++) {
                    const angle = (i / numCrystals) * Math.PI * 2;
                    const length = 150 + Math.random() * 100;
                    let x = cx, y = cy;
                    let path = `M${cx} ${cy}`;
                    
                    const segments = 6;
                    for (let j = 0; j < segments; j++) {
                        const segLength = length / segments;
                        x += Math.cos(angle) * segLength;
                        y += Math.sin(angle) * segLength;
                        path += ` L${x} ${y}`;
                        
                        // Ice crystal branches (60 degree angles)
                        if (j > 0 && j < segments - 1) {
                            const branchLen = segLength * 0.5;
                            for (const dir of [1, -1]) {
                                const branchAngle = angle + dir * Math.PI / 3;
                                const bx = x + Math.cos(branchAngle) * branchLen;
                                const by = y + Math.sin(branchAngle) * branchLen;
                                paths.push(`M${x} ${y} L${bx} ${by}`);
                            }
                        }
                    }
                    paths.push(path);
                }
                
                return paths;
            },
            
            glitch: (cx, cy, intensity) => {
                const paths = [];
                const numLines = intensity === 'heavy' ? 15 : intensity === 'light' ? 5 : 10;
                
                // Horizontal glitch lines
                for (let i = 0; i < numLines; i++) {
                    const y = Math.random() * 500;
                    const x1 = Math.random() * 200;
                    const x2 = 600 + Math.random() * 200;
                    paths.push(`M${x1} ${y} L${x2} ${y}`);
                }
                
                // Vertical displacement lines
                for (let i = 0; i < numLines / 2; i++) {
                    const x = Math.random() * 800;
                    const y1 = Math.random() * 100;
                    const y2 = 400 + Math.random() * 100;
                    paths.push(`M${x} ${y1} L${x} ${y2}`);
                }
                
                // Block distortions
                for (let i = 0; i < 5; i++) {
                    const x = Math.random() * 700;
                    const y = Math.random() * 400;
                    const w = 20 + Math.random() * 80;
                    const h = 10 + Math.random() * 40;
                    paths.push(`M${x} ${y} L${x+w} ${y} L${x+w} ${y+h} L${x} ${y+h} Z`);
                }
                
                return paths;
            },
            
            neon: (cx, cy, intensity) => {
                const paths = [];
                const numCurves = intensity === 'heavy' ? 12 : intensity === 'light' ? 5 : 8;
                
                for (let i = 0; i < numCurves; i++) {
                    const startAngle = Math.random() * Math.PI * 2;
                    const length = 100 + Math.random() * 200;
                    
                    const x1 = cx;
                    const y1 = cy;
                    const x2 = cx + Math.cos(startAngle) * length;
                    const y2 = cy + Math.sin(startAngle) * length;
                    
                    // Control points for curves
                    const cpx = cx + Math.cos(startAngle + 0.5) * (length * 0.6);
                    const cpy = cy + Math.sin(startAngle + 0.5) * (length * 0.6);
                    
                    paths.push(`M${x1} ${y1} Q${cpx} ${cpy} ${x2} ${y2}`);
                }
                
                return paths;
            }
        };
        
        function getImpactPosition() {
            const select = document.getElementById('impactPoint');
            const container = document.getElementById('demoContainer');
            const rect = container.getBoundingClientRect();
            
            switch(select.value) {
                case 'center':
                    return { x: 400, y: 250 };
                case 'top':
                    return { x: 400, y: 100 };
                case 'bottom':
                    return { x: 400, y: 400 };
                case 'random':
                default:
                    return { 
                        x: 100 + Math.random() * 600, 
                        y: 100 + Math.random() * 300 
                    };
            }
        }
        
        function createDebris(cx, cy, count) {
            const container = document.getElementById('debrisContainer');
            container.innerHTML = '';
            
            for (let i = 0; i < count; i++) {
                const debris = document.createElement('div');
                debris.className = 'debris';
                
                const size = 3 + Math.random() * 8;
                const angle = Math.random() * Math.PI * 2;
                const distance = 50 + Math.random() * 150;
                
                debris.style.width = size + 'px';
                debris.style.height = size + 'px';
                debris.style.left = cx + 'px';
                debris.style.top = cy + 'px';
                debris.style.setProperty('--debris-x', Math.cos(angle) * distance + 'px');
                debris.style.setProperty('--debris-y', Math.sin(angle) * distance + 100 + 'px');
                debris.style.setProperty('--debris-rot', (Math.random() * 720 - 360) + 'deg');
                debris.style.animationDelay = (Math.random() * 0.2) + 's';
                
                // Random shapes
                const shapes = [
                    'polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)',
                    'polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)',
                    'polygon(50% 0%, 100% 100%, 0% 100%)'
                ];
                debris.style.clipPath = shapes[Math.floor(Math.random() * shapes.length)];
                
                container.appendChild(debris);
                
                setTimeout(() => debris.classList.add('active'), 50);
            }
        }
        
        function createGlassShards(cx, cy, count) {
            const overlay = document.getElementById('crackOverlay');
            
            // Remove existing shards
            overlay.querySelectorAll('.glass-shard').forEach(s => s.remove());
            
            for (let i = 0; i < count; i++) {
                const shard = document.createElement('div');
                shard.className = 'glass-shard';
                
                const size = 10 + Math.random() * 30;
                const angle = Math.random() * Math.PI * 2;
                const dist = 20 + Math.random() * 60;
                
                shard.style.width = size + 'px';
                shard.style.height = size + 'px';
                shard.style.left = (cx + Math.cos(angle) * dist) + 'px';
                shard.style.top = (cy + Math.sin(angle) * dist) + 'px';
                shard.style.setProperty('--fall-x', (Math.random() - 0.5) * 200 + 'px');
                shard.style.setProperty('--fall-y', 150 + Math.random() * 200 + 'px');
                shard.style.setProperty('--fall-rot', (Math.random() * 360) + 'deg');
                shard.style.animationDelay = (0.2 + Math.random() * 0.3) + 's';
                
                overlay.appendChild(shard);
            }
        }
        
        function triggerFailure() {
            if (isAnimating) return;
            isAnimating = true;
            isFailed = true;
            
            const style = document.getElementById('crackStyle').value;
            const intensity = document.getElementById('intensity').value;
            const { x: cx, y: cy } = getImpactPosition();
            
            const container = document.getElementById('demoContainer');
            const overlay = document.getElementById('crackOverlay');
            const svg = document.getElementById('crackSvg');
            const flash = document.getElementById('screenFlash');
            const vignette = document.getElementById('damageVignette');
            const impact = document.getElementById('impactPoint');
            const character = document.getElementById('gameCharacter');
            const missionText = document.getElementById('missionText');
            const retryButton = document.getElementById('retryButton');
            
            // Clear previous
            svg.innerHTML = '';
            overlay.className = 'crack-overlay';
            
            // Impact point animation
            impact.style.left = cx + 'px';
            impact.style.top = cy + 'px';
            impact.classList.add('active');
            
            // Screen shake
            container.classList.add('shaking');
            
            // Screen flash
            flash.classList.add('active');
            
            // Generate crack paths
            const paths = crackPatterns[style](cx, cy, intensity);
            
            // Add paths to SVG with staggered animation
            paths.forEach((pathData, index) => {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathData);
                path.classList.add('crack-line');
                path.style.animationDelay = (index * 0.02) + 's';
                svg.appendChild(path);
            });
            
            // Apply style classes
            overlay.classList.add(style);
            overlay.classList.add(`intensity-${intensity}`);
            overlay.classList.add('active');
            
            // Create debris
            const debrisCount = intensity === 'heavy' ? 30 : intensity === 'light' ? 10 : 20;
            createDebris(cx, cy, debrisCount);
            
            // Create glass shards
            const shardCount = intensity === 'heavy' ? 15 : intensity === 'light' ? 5 : 10;
            createGlassShards(cx, cy, shardCount);
            
            // Damage vignette
            setTimeout(() => {
                vignette.classList.add('active');
            }, 200);
            
            // Character defeated
            setTimeout(() => {
                character.classList.add('defeated');
            }, 300);
            
            // Show mission failed text
            setTimeout(() => {
                missionText.classList.add('visible', 'failed');
            }, 500);
            
            // Show retry button
            setTimeout(() => {
                retryButton.classList.add('visible');
            }, 1000);
            
            // Cleanup animations
            setTimeout(() => {
                container.classList.remove('shaking');
                flash.classList.remove('active');
                impact.classList.remove('active');
                isAnimating = false;
            }, 1500);
        }
        
        function resetScreen() {
            const overlay = document.getElementById('crackOverlay');
            const svg = document.getElementById('crackSvg');
            const vignette = document.getElementById('damageVignette');
            const character = document.getElementById('gameCharacter');
            const missionText = document.getElementById('missionText');
            const retryButton = document.getElementById('retryButton');
            const debrisContainer = document.getElementById('debrisContainer');
            
            overlay.className = 'crack-overlay';
            svg.innerHTML = '';
            vignette.classList.remove('active');
            character.classList.remove('defeated');
            missionText.classList.remove('visible', 'failed');
            retryButton.classList.remove('visible');
            debrisContainer.innerHTML = '';
            
            // Remove glass shards
            overlay.querySelectorAll('.glass-shard').forEach(s => s.remove());
            
            isFailed = false;
        }
        
        function setStyleAndTrigger(style) {
            document.getElementById('crackStyle').value = style;
            resetScreen();
            setTimeout(triggerFailure, 100);
        }
        
        // Keyboard shortcut
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && !e.repeat) {
                e.preventDefault();
                if (isFailed) {
                    resetScreen();
                    setTimeout(triggerFailure, 100);
                } else {
                    triggerFailure();
                }
            }
        });
    </script>
</body>
</html>
