<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Bar Refill Wave</title>
    <link rel="stylesheet" href="../../../jazer-brand.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: var(--font-body); 
            background: var(--bg-dark); 
            color: var(--text-light); 
            padding: 2rem;
            min-height: 100vh;
        }
        
        .hero-section {
            text-align: center;
            padding: 3rem 0;
            margin-bottom: 2rem;
        }
        
        h1 { 
            background: var(--gradient-text); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            font-size: clamp(2rem, 5vw, 3.5rem);
            margin-bottom: 1rem;
            font-weight: 800;
        }
        
        .subtitle {
            color: var(--text-muted);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .back-button { 
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--jazer-cyan); 
            text-decoration: none; 
            font-weight: 600; 
            padding: 0.75rem 1.5rem; 
            border-radius: 12px; 
            border: 2px solid var(--jazer-cyan); 
            background: rgba(0, 242, 234, 0.1); 
            margin-bottom: 2rem; 
            transition: all 0.3s ease; 
        }
        .back-button:hover { 
            background: var(--jazer-cyan); 
            color: var(--bg-dark); 
            transform: translateX(-5px); 
            box-shadow: 0 0 30px rgba(0, 242, 234, 0.5); 
        }
        
        /* Main Demo Area */
        .demo-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3rem;
            padding: 3rem;
            background: linear-gradient(135deg, rgba(0, 242, 234, 0.05), rgba(147, 51, 234, 0.05));
            border-radius: 24px;
            border: 2px solid rgba(0, 242, 234, 0.2);
            margin-bottom: 3rem;
        }
        
        /* Energy Bar Container */
        .energy-container {
            position: relative;
            width: 100%;
            max-width: 500px;
        }
        
        .energy-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .energy-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--jazer-cyan);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .energy-title .icon {
            font-size: 1.5rem;
        }
        
        .energy-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--text-light);
        }
        
        .energy-value .current {
            color: var(--jazer-cyan);
        }
        
        .energy-value .max {
            color: var(--text-muted);
        }
        
        /* Energy Bar */
        .energy-bar {
            position: relative;
            width: 100%;
            height: 50px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 25px;
            overflow: hidden;
            border: 3px solid rgba(0, 242, 234, 0.3);
            box-shadow: 
                inset 0 4px 10px rgba(0, 0, 0, 0.5),
                0 0 20px rgba(0, 242, 234, 0.2);
        }
        
        .energy-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 20%;
            background: linear-gradient(90deg, #00ff88, #00f2ea, #00ff88);
            background-size: 200% 100%;
            border-radius: 22px;
            transition: width 0.1s linear;
            box-shadow: 
                0 0 20px rgba(0, 255, 136, 0.5),
                0 0 40px rgba(0, 242, 234, 0.3);
        }
        
        .energy-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.3), transparent);
            border-radius: 22px 22px 0 0;
        }
        
        /* Wave Effect */
        .energy-wave {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.4) 50%, 
                transparent 100%);
            transform: translateX(-100%);
            opacity: 0;
            pointer-events: none;
        }
        
        .energy-wave.animate {
            animation: waveMove 0.8s ease-out;
        }
        
        @keyframes waveMove {
            0% {
                transform: translateX(-100%);
                opacity: 1;
            }
            100% {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        /* Bubble Particles */
        .energy-bubbles {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            overflow: hidden;
            border-radius: 22px;
        }
        
        .bubble {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.8), rgba(0, 255, 136, 0.5));
            border-radius: 50%;
            opacity: 0;
        }
        
        /* Segments */
        .energy-segments {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            pointer-events: none;
        }
        
        .segment {
            flex: 1;
            border-right: 2px solid rgba(0, 0, 0, 0.3);
        }
        
        .segment:last-child {
            border-right: none;
        }
        
        /* Refilling Animation State */
        .energy-bar.refilling .energy-fill {
            animation: energyPulse 0.5s ease-in-out infinite;
        }
        
        @keyframes energyPulse {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }
        
        /* Full State */
        .energy-bar.full .energy-fill {
            background: linear-gradient(90deg, #00ff88, #00f2ea, #9333ea, #00ff88);
            background-size: 300% 100%;
            animation: fullShimmer 2s linear infinite;
        }
        
        @keyframes fullShimmer {
            0% { background-position: 0% 50%; }
            100% { background-position: 300% 50%; }
        }
        
        /* Low Energy State */
        .energy-bar.low .energy-fill {
            background: linear-gradient(90deg, #ff006e, #ff4444, #ff006e);
            background-size: 200% 100%;
            animation: lowPulse 0.5s ease-in-out infinite;
        }
        
        @keyframes lowPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Controls */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
        }
        
        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: var(--font-body);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--jazer-cyan), var(--jazer-purple));
            color: white;
            box-shadow: 0 5px 20px rgba(0, 242, 234, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 242, 234, 0.5);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--jazer-cyan);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff006e, #ff4444);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 0, 110, 0.5);
        }
        
        /* Animation Styles Section */
        .styles-section {
            margin-bottom: 3rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--jazer-pink);
            text-align: center;
        }
        
        .style-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
            margin-bottom: 2rem;
        }
        
        .style-btn {
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--text-light);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: var(--font-body);
        }
        
        .style-btn:hover {
            border-color: var(--jazer-cyan);
            background: rgba(0, 242, 234, 0.1);
        }
        
        .style-btn.active {
            background: linear-gradient(135deg, var(--jazer-cyan), var(--jazer-purple));
            border-color: transparent;
            color: white;
        }
        
        /* Gallery Grid */
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
        }
        
        .gallery-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 2rem;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .gallery-item:hover {
            border-color: var(--jazer-cyan);
            transform: translateY(-5px);
        }
        
        .gallery-item h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--jazer-cyan);
        }
        
        /* Mini Energy Bars */
        .mini-energy-bar {
            position: relative;
            width: 100%;
            height: 30px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid rgba(0, 242, 234, 0.3);
            margin-bottom: 1rem;
        }
        
        .mini-energy-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            border-radius: 13px;
            transition: width 0.3s ease;
        }
        
        /* Wave Style */
        .wave-style .mini-energy-fill {
            background: linear-gradient(90deg, #00ff88, #00f2ea);
            animation: waveFlow 2s linear infinite;
        }
        
        @keyframes waveFlow {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        
        /* Pulse Style */
        .pulse-style .mini-energy-fill {
            background: linear-gradient(90deg, #9333ea, #ff006e);
            animation: pulseGlow 1s ease-in-out infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { 
                box-shadow: 0 0 10px rgba(147, 51, 234, 0.5);
                filter: brightness(1);
            }
            50% { 
                box-shadow: 0 0 30px rgba(147, 51, 234, 0.8);
                filter: brightness(1.3);
            }
        }
        
        /* Electric Style */
        .electric-style .mini-energy-fill {
            background: linear-gradient(90deg, #00f2ea, #fff, #00f2ea);
            background-size: 200% 100%;
            animation: electricSpark 0.3s linear infinite;
        }
        
        @keyframes electricSpark {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }
        
        /* Rainbow Style */
        .rainbow-style .mini-energy-fill {
            background: linear-gradient(90deg, #ff006e, #ff8800, #ffff00, #00ff88, #00f2ea, #9333ea, #ff006e);
            background-size: 400% 100%;
            animation: rainbowShift 3s linear infinite;
        }
        
        @keyframes rainbowShift {
            0% { background-position: 0% 50%; }
            100% { background-position: 400% 50%; }
        }
        
        /* Glitch Style */
        .glitch-style .mini-energy-fill {
            background: linear-gradient(90deg, #00ff88, #00f2ea);
            animation: glitchBar 0.5s steps(1) infinite;
        }
        
        @keyframes glitchBar {
            0%, 90% { transform: translateX(0); }
            92% { transform: translateX(-3px); }
            94% { transform: translateX(3px); }
            96% { transform: translateX(-2px); }
            98% { transform: translateX(2px); }
        }
        
        /* Liquid Style */
        .liquid-style .mini-energy-fill {
            background: linear-gradient(90deg, #00ff88, #00f2ea);
            border-radius: 13px;
            overflow: hidden;
        }
        
        .liquid-style .mini-energy-fill::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(ellipse at center, rgba(255,255,255,0.3) 0%, transparent 70%);
            animation: liquidWobble 2s ease-in-out infinite;
        }
        
        @keyframes liquidWobble {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(5%, 5%) rotate(5deg); }
            50% { transform: translate(0, 10%) rotate(0deg); }
            75% { transform: translate(-5%, 5%) rotate(-5deg); }
        }
        
        /* Particle Effects Container */
        .particles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            overflow: hidden;
        }
        
        .energy-particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, var(--jazer-cyan), transparent);
            border-radius: 50%;
            pointer-events: none;
        }
        
        /* Timer Display */
        .timer-display {
            text-align: center;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--text-muted);
        }
        
        .timer-display.refilling {
            color: var(--jazer-cyan);
            animation: timerPulse 1s ease-in-out infinite;
        }
        
        @keyframes timerPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Keyboard hint */
        .keyboard-hint {
            text-align: center;
            margin-top: 1.5rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        .keyboard-hint kbd {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-family: var(--font-body);
            margin: 0 0.25rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Refill notification */
        .refill-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.95), rgba(0, 242, 234, 0.95));
            padding: 2rem 4rem;
            border-radius: 20px;
            font-size: 1.5rem;
            font-weight: 800;
            color: #000;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            box-shadow: 0 0 60px rgba(0, 255, 136, 0.8);
        }
        
        .refill-notification.show {
            animation: notificationPop 1.5s ease-out forwards;
        }
        
        @keyframes notificationPop {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            20% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
            30% {
                transform: translate(-50%, -50%) scale(1);
            }
            80% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            body { padding: 1rem; }
            .demo-area { padding: 1.5rem; }
            .gallery { grid-template-columns: 1fr; }
            .controls { flex-direction: column; }
            .btn { width: 100%; }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-button">← Back</a>
    
    <div class="hero-section">
        <h1>Energy Bar Refill Wave</h1>
        <p class="subtitle">Satisfying energy refill animations with wave effects, bubbles, and dynamic visual feedback</p>
    </div>
    
    <!-- Main Demo -->
    <div class="demo-area">
        <div class="energy-container">
            <div class="energy-label">
                <span class="energy-title">
                    <span class="icon">⚡</span>
                    ENERGY
                </span>
                <span class="energy-value">
                    <span class="current" id="energyValue">20</span><span class="max">/100</span>
                </span>
            </div>
            <div class="energy-bar" id="energyBar">
                <div class="energy-fill" id="energyFill"></div>
                <div class="energy-wave" id="energyWave"></div>
                <div class="energy-bubbles" id="energyBubbles"></div>
                <div class="energy-segments">
                    <div class="segment"></div>
                    <div class="segment"></div>
                    <div class="segment"></div>
                    <div class="segment"></div>
                    <div class="segment"></div>
                </div>
            </div>
            <div class="timer-display" id="timerDisplay">Tap refill to restore energy</div>
        </div>
        
        <div class="controls">
            <button class="btn btn-primary" id="refillBtn">⚡ Refill Energy</button>
            <button class="btn btn-secondary" id="useEnergyBtn">Use Energy (-10)</button>
            <button class="btn btn-danger" id="drainBtn">Drain All</button>
            <button class="btn btn-secondary" id="instantFillBtn">Instant Fill</button>
        </div>
        
        <div class="keyboard-hint">
            Press <kbd>Space</kbd> to refill | <kbd>U</kbd> to use energy | <kbd>D</kbd> to drain
        </div>
    </div>
    
    <!-- Animation Styles -->
    <div class="styles-section">
        <h2 class="section-title">Animation Styles</h2>
        
        <div class="style-selector">
            <button class="style-btn active" data-style="wave">Wave</button>
            <button class="style-btn" data-style="pulse">Pulse</button>
            <button class="style-btn" data-style="electric">Electric</button>
            <button class="style-btn" data-style="rainbow">Rainbow</button>
            <button class="style-btn" data-style="glitch">Glitch</button>
            <button class="style-btn" data-style="liquid">Liquid</button>
        </div>
        
        <div class="gallery">
            <div class="gallery-item wave-style">
                <h3>Wave Flow</h3>
                <div class="mini-energy-bar">
                    <div class="mini-energy-fill" style="width: 75%;"></div>
                </div>
                <p style="color: var(--text-muted); font-size: 0.9rem;">Smooth flowing wave animation with gradient shifts</p>
            </div>
            
            <div class="gallery-item pulse-style">
                <h3>Pulse Glow</h3>
                <div class="mini-energy-bar">
                    <div class="mini-energy-fill" style="width: 60%;"></div>
                </div>
                <p style="color: var(--text-muted); font-size: 0.9rem;">Pulsing glow effect with brightness variation</p>
            </div>
            
            <div class="gallery-item electric-style">
                <h3>Electric Spark</h3>
                <div class="mini-energy-bar">
                    <div class="mini-energy-fill" style="width: 85%;"></div>
                </div>
                <p style="color: var(--text-muted); font-size: 0.9rem;">Fast electric sparking effect</p>
            </div>
            
            <div class="gallery-item rainbow-style">
                <h3>Rainbow Shift</h3>
                <div class="mini-energy-bar">
                    <div class="mini-energy-fill" style="width: 70%;"></div>
                </div>
                <p style="color: var(--text-muted); font-size: 0.9rem;">Full spectrum color cycling</p>
            </div>
            
            <div class="gallery-item glitch-style">
                <h3>Glitch Effect</h3>
                <div class="mini-energy-bar">
                    <div class="mini-energy-fill" style="width: 50%;"></div>
                </div>
                <p style="color: var(--text-muted); font-size: 0.9rem;">Digital glitch distortion</p>
            </div>
            
            <div class="gallery-item liquid-style">
                <h3>Liquid Wobble</h3>
                <div class="mini-energy-bar">
                    <div class="mini-energy-fill" style="width: 65%;"></div>
                </div>
                <p style="color: var(--text-muted); font-size: 0.9rem;">Organic liquid movement effect</p>
            </div>
        </div>
    </div>
    
    <!-- Particles Container -->
    <div class="particles-container" id="particlesContainer"></div>
    
    <!-- Refill Notification -->
    <div class="refill-notification" id="refillNotification">⚡ ENERGY RESTORED!</div>
    
    <script>
        // Energy State
        let currentEnergy = 20;
        const maxEnergy = 100;
        let isRefilling = false;
        let currentStyle = 'wave';
        
        // DOM Elements
        const energyBar = document.getElementById('energyBar');
        const energyFill = document.getElementById('energyFill');
        const energyWave = document.getElementById('energyWave');
        const energyBubbles = document.getElementById('energyBubbles');
        const energyValue = document.getElementById('energyValue');
        const timerDisplay = document.getElementById('timerDisplay');
        const particlesContainer = document.getElementById('particlesContainer');
        const refillNotification = document.getElementById('refillNotification');
        
        // Update Energy Bar
        function updateEnergyBar() {
            const percentage = (currentEnergy / maxEnergy) * 100;
            energyFill.style.width = `${percentage}%`;
            energyValue.textContent = Math.round(currentEnergy);
            
            // Update states
            energyBar.classList.remove('low', 'full');
            if (currentEnergy <= 20) {
                energyBar.classList.add('low');
            } else if (currentEnergy >= maxEnergy) {
                energyBar.classList.add('full');
            }
        }
        
        // Create Bubble
        function createBubble() {
            const bubble = document.createElement('div');
            bubble.className = 'bubble';
            bubble.style.left = `${Math.random() * 100}%`;
            bubble.style.bottom = '0';
            bubble.style.animation = `bubbleRise ${0.5 + Math.random() * 0.5}s ease-out forwards`;
            energyBubbles.appendChild(bubble);
            
            setTimeout(() => bubble.remove(), 1000);
        }
        
        // Add bubble animation
        const bubbleStyle = document.createElement('style');
        bubbleStyle.textContent = `
            @keyframes bubbleRise {
                0% {
                    transform: translateY(0) scale(0);
                    opacity: 0;
                }
                20% {
                    opacity: 1;
                    transform: translateY(-10px) scale(1);
                }
                100% {
                    transform: translateY(-50px) scale(0.5);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(bubbleStyle);
        
        // Create Energy Particle
        function createEnergyParticle(x, y) {
            const particle = document.createElement('div');
            particle.className = 'energy-particle';
            particle.style.left = `${x}px`;
            particle.style.top = `${y}px`;
            
            const angle = Math.random() * Math.PI * 2;
            const velocity = 50 + Math.random() * 100;
            const vx = Math.cos(angle) * velocity;
            const vy = Math.sin(angle) * velocity;
            
            particle.style.animation = 'none';
            particlesContainer.appendChild(particle);
            
            let posX = x;
            let posY = y;
            let opacity = 1;
            
            function animate() {
                posX += vx * 0.02;
                posY += vy * 0.02 - 2;
                opacity -= 0.02;
                
                particle.style.left = `${posX}px`;
                particle.style.top = `${posY}px`;
                particle.style.opacity = opacity;
                
                if (opacity > 0) {
                    requestAnimationFrame(animate);
                } else {
                    particle.remove();
                }
            }
            
            requestAnimationFrame(animate);
        }
        
        // Trigger Wave Effect
        function triggerWave() {
            energyWave.classList.remove('animate');
            void energyWave.offsetWidth;
            energyWave.classList.add('animate');
        }
        
        // Refill Energy with Animation
        async function refillEnergy() {
            if (isRefilling || currentEnergy >= maxEnergy) return;
            
            isRefilling = true;
            energyBar.classList.add('refilling');
            timerDisplay.classList.add('refilling');
            
            const startEnergy = currentEnergy;
            const targetEnergy = maxEnergy;
            const duration = 2000;
            const startTime = performance.now();
            
            // Spawn particles at bar location
            const barRect = energyBar.getBoundingClientRect();
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    createEnergyParticle(
                        barRect.left + Math.random() * barRect.width,
                        barRect.top + Math.random() * barRect.height
                    );
                }, i * 50);
            }
            
            // Create bubbles during refill
            const bubbleInterval = setInterval(() => {
                for (let i = 0; i < 3; i++) {
                    createBubble();
                }
            }, 100);
            
            // Animate refill
            function animateRefill(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function
                const eased = 1 - Math.pow(1 - progress, 3);
                currentEnergy = startEnergy + (targetEnergy - startEnergy) * eased;
                
                updateEnergyBar();
                timerDisplay.textContent = `Refilling... ${Math.round(progress * 100)}%`;
                
                // Trigger wave at intervals
                if (Math.floor(progress * 10) !== Math.floor((progress - 0.01) * 10)) {
                    triggerWave();
                }
                
                if (progress < 1) {
                    requestAnimationFrame(animateRefill);
                } else {
                    // Complete
                    clearInterval(bubbleInterval);
                    isRefilling = false;
                    energyBar.classList.remove('refilling');
                    timerDisplay.classList.remove('refilling');
                    timerDisplay.textContent = 'Energy fully restored!';
                    
                    // Show notification
                    showNotification();
                    
                    // Final wave burst
                    triggerWave();
                    for (let i = 0; i < 30; i++) {
                        setTimeout(() => createBubble(), i * 30);
                    }
                }
            }
            
            requestAnimationFrame(animateRefill);
        }
        
        // Use Energy
        function useEnergy(amount = 10) {
            if (currentEnergy <= 0) return;
            
            currentEnergy = Math.max(0, currentEnergy - amount);
            updateEnergyBar();
            
            if (currentEnergy <= 0) {
                timerDisplay.textContent = 'Energy depleted! Refill needed.';
            } else {
                timerDisplay.textContent = `Energy used: -${amount}`;
            }
        }
        
        // Drain All
        function drainAll() {
            const startEnergy = currentEnergy;
            const duration = 500;
            const startTime = performance.now();
            
            function animateDrain(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                currentEnergy = startEnergy * (1 - progress);
                updateEnergyBar();
                
                if (progress < 1) {
                    requestAnimationFrame(animateDrain);
                } else {
                    currentEnergy = 0;
                    updateEnergyBar();
                    timerDisplay.textContent = 'Energy depleted! Refill needed.';
                }
            }
            
            requestAnimationFrame(animateDrain);
        }
        
        // Instant Fill
        function instantFill() {
            currentEnergy = maxEnergy;
            updateEnergyBar();
            triggerWave();
            showNotification();
            
            // Burst of bubbles
            for (let i = 0; i < 20; i++) {
                setTimeout(() => createBubble(), i * 20);
            }
            
            timerDisplay.textContent = 'Energy instantly restored!';
        }
        
        // Show Notification
        function showNotification() {
            refillNotification.classList.remove('show');
            void refillNotification.offsetWidth;
            refillNotification.classList.add('show');
            
            setTimeout(() => {
                refillNotification.classList.remove('show');
            }, 1500);
        }
        
        // Apply Animation Style
        function applyStyle(style) {
            currentStyle = style;
            
            // Update style buttons
            document.querySelectorAll('.style-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.style === style);
            });
            
            // Apply to main energy bar
            energyFill.style.animation = 'none';
            
            switch(style) {
                case 'wave':
                    energyFill.style.background = 'linear-gradient(90deg, #00ff88, #00f2ea, #00ff88)';
                    energyFill.style.backgroundSize = '200% 100%';
                    break;
                case 'pulse':
                    energyFill.style.background = 'linear-gradient(90deg, #9333ea, #ff006e)';
                    energyFill.style.animation = 'pulseGlow 1s ease-in-out infinite';
                    break;
                case 'electric':
                    energyFill.style.background = 'linear-gradient(90deg, #00f2ea, #fff, #00f2ea)';
                    energyFill.style.backgroundSize = '200% 100%';
                    energyFill.style.animation = 'electricSpark 0.3s linear infinite';
                    break;
                case 'rainbow':
                    energyFill.style.background = 'linear-gradient(90deg, #ff006e, #ff8800, #ffff00, #00ff88, #00f2ea, #9333ea, #ff006e)';
                    energyFill.style.backgroundSize = '400% 100%';
                    energyFill.style.animation = 'rainbowShift 3s linear infinite';
                    break;
                case 'glitch':
                    energyFill.style.background = 'linear-gradient(90deg, #00ff88, #00f2ea)';
                    energyFill.style.animation = 'glitchBar 0.5s steps(1) infinite';
                    break;
                case 'liquid':
                    energyFill.style.background = 'linear-gradient(90deg, #00ff88, #00f2ea)';
                    break;
            }
        }
        
        // Event Listeners
        document.getElementById('refillBtn').addEventListener('click', refillEnergy);
        document.getElementById('useEnergyBtn').addEventListener('click', () => useEnergy(10));
        document.getElementById('drainBtn').addEventListener('click', drainAll);
        document.getElementById('instantFillBtn').addEventListener('click', instantFill);
        
        // Style selector
        document.querySelectorAll('.style-btn').forEach(btn => {
            btn.addEventListener('click', () => applyStyle(btn.dataset.style));
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                refillEnergy();
            } else if (e.code === 'KeyU') {
                useEnergy(10);
            } else if (e.code === 'KeyD') {
                drainAll();
            }
        });
        
        // Initialize
        updateEnergyBar();
    </script>
</body>
</html>
