<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Event Tracker - JaZeR DevTools</title>
    <link rel="stylesheet" href="../../../jazer-brand.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Courier New', monospace; 
            background: #0a0a0a;
            min-height: 100vh; 
            color: #e0e0e0;
        }
        .devtools-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .devtools-header {
            background: #1a1a1a;
            border-bottom: 2px solid var(--jazer-cyan);
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--jazer-cyan);
            text-decoration: none;
            padding: 0.4rem 0.8rem;
            border: 1px solid var(--jazer-cyan);
            border-radius: 4px;
            background: rgba(0, 255, 255, 0.1);
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }
        .back-button:hover {
            background: var(--jazer-cyan);
            color: #0a0a0a;
        }
        .header-title {
            font-size: 1rem;
            color: var(--jazer-cyan);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .header-title::before {
            content: 'üìä';
        }
        .header-stats {
            display: flex;
            gap: 1.5rem;
            margin-left: auto;
            font-size: 0.75rem;
        }
        .header-stat {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        .header-stat-label {
            color: #666;
        }
        .header-stat-value {
            color: var(--jazer-cyan);
            font-weight: 600;
        }
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            color: #39ff14;
            font-size: 0.75rem;
        }
        .live-dot {
            width: 8px;
            height: 8px;
            background: #39ff14;
            border-radius: 50%;
            animation: livePulse 1s ease-in-out infinite;
        }
        @keyframes livePulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 8px #39ff14; }
            50% { opacity: 0.5; box-shadow: 0 0 4px #39ff14; }
        }

        /* Toolbar */
        .toolbar {
            background: #141414;
            border-bottom: 1px solid #333;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        .toolbar-btn {
            padding: 0.4rem 0.8rem;
            font-size: 0.75rem;
            border-radius: 4px;
            border: 1px solid #444;
            background: #1a1a1a;
            color: #aaa;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        .toolbar-btn:hover {
            border-color: var(--jazer-cyan);
            color: var(--jazer-cyan);
        }
        .toolbar-btn.active {
            background: rgba(0, 255, 255, 0.15);
            border-color: var(--jazer-cyan);
            color: var(--jazer-cyan);
        }
        .toolbar-btn.recording {
            background: rgba(255, 71, 87, 0.2);
            border-color: #ff4757;
            color: #ff4757;
        }
        .toolbar-btn.recording::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #ff4757;
            border-radius: 50%;
            animation: recordPulse 1s ease-in-out infinite;
        }
        @keyframes recordPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        .search-input {
            padding: 0.4rem 0.8rem;
            font-size: 0.75rem;
            border-radius: 4px;
            border: 1px solid #444;
            background: #0a0a0a;
            color: #e0e0e0;
            font-family: inherit;
            width: 200px;
        }
        .search-input:focus {
            outline: none;
            border-color: var(--jazer-cyan);
        }
        .filter-select {
            padding: 0.4rem 0.8rem;
            font-size: 0.75rem;
            border-radius: 4px;
            border: 1px solid #444;
            background: #1a1a1a;
            color: #aaa;
            font-family: inherit;
            cursor: pointer;
        }
        .toolbar-divider {
            width: 1px;
            height: 24px;
            background: #333;
        }
        .toolbar-spacer {
            flex: 1;
        }
        .event-count {
            font-size: 0.75rem;
            color: #666;
        }
        .event-count span {
            color: var(--jazer-cyan);
            font-weight: 600;
        }

        /* Main Layout */
        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* Event Stream */
        .stream-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .stream-header {
            background: #141414;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            font-size: 0.7rem;
            color: #666;
            border-bottom: 1px solid #2a2a2a;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .stream-col {
            padding: 0 0.5rem;
        }
        .stream-col.time { width: 100px; }
        .stream-col.type { width: 120px; }
        .stream-col.name { flex: 1; }
        .stream-col.user { width: 150px; }
        .stream-col.source { width: 100px; }

        .stream-list {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
        }
        .stream-item {
            display: flex;
            align-items: center;
            padding: 0.6rem 1rem;
            border-bottom: 1px solid #1a1a1a;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background 0.15s ease;
            animation: slideIn 0.2s ease;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .stream-item:hover {
            background: rgba(255, 255, 255, 0.03);
        }
        .stream-item.selected {
            background: rgba(0, 255, 255, 0.1);
            border-left: 3px solid var(--jazer-cyan);
        }
        .stream-item.new {
            background: rgba(57, 255, 20, 0.05);
        }
        .item-time {
            width: 100px;
            color: #666;
            font-size: 0.7rem;
            padding-right: 0.5rem;
        }
        .item-type {
            width: 120px;
            padding: 0 0.5rem;
        }
        .type-badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .type-badge.page_view { background: rgba(6, 182, 212, 0.2); color: var(--jazer-cyan); }
        .type-badge.click { background: rgba(147, 51, 234, 0.2); color: #a78bfa; }
        .type-badge.form_submit { background: rgba(57, 255, 20, 0.2); color: #39ff14; }
        .type-badge.purchase { background: rgba(255, 190, 11, 0.2); color: #ffbe0b; }
        .type-badge.error { background: rgba(255, 71, 87, 0.2); color: #ff4757; }
        .type-badge.custom { background: rgba(255, 255, 255, 0.1); color: #888; }
        .type-badge.signup { background: rgba(236, 72, 153, 0.2); color: #ec4899; }
        .type-badge.search { background: rgba(99, 102, 241, 0.2); color: #818cf8; }

        .item-name {
            flex: 1;
            color: #fff;
            padding: 0 0.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .item-user {
            width: 150px;
            color: #888;
            padding: 0 0.5rem;
            font-size: 0.75rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .item-source {
            width: 100px;
            padding: 0 0.5rem;
        }
        .source-badge {
            display: inline-block;
            padding: 0.15rem 0.4rem;
            border-radius: 3px;
            font-size: 0.6rem;
            background: #2a2a2a;
            color: #888;
        }
        .source-badge.web { color: var(--jazer-cyan); }
        .source-badge.ios { color: #ff9500; }
        .source-badge.android { color: #39ff14; }
        .source-badge.api { color: #a78bfa; }

        /* Details Panel */
        .details-panel {
            width: 400px;
            background: #141414;
            border-left: 1px solid #333;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .details-panel.hidden {
            display: none;
        }
        .details-header {
            padding: 1rem;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
        }
        .details-title-group {
            flex: 1;
        }
        .details-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 0.25rem;
        }
        .details-subtitle {
            font-size: 0.7rem;
            color: #666;
        }
        .close-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.2rem;
            line-height: 1;
        }
        .close-btn:hover {
            color: #fff;
        }
        .details-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        .detail-section {
            margin-bottom: 1.5rem;
        }
        .detail-section-title {
            font-size: 0.7rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #2a2a2a;
        }
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 0.4rem 0;
            font-size: 0.8rem;
        }
        .detail-label {
            color: #888;
        }
        .detail-value {
            color: #fff;
            font-weight: 500;
            text-align: right;
            max-width: 200px;
            word-break: break-all;
        }

        /* Properties Tree */
        .properties-tree {
            background: #0f0f0f;
            border-radius: 6px;
            padding: 0.75rem;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
        }
        .prop-item {
            padding: 0.3rem 0;
            display: flex;
            gap: 0.5rem;
        }
        .prop-item.nested {
            padding-left: 1rem;
            border-left: 1px solid #2a2a2a;
            margin-left: 0.5rem;
        }
        .prop-key {
            color: #ff79c6;
        }
        .prop-value {
            color: var(--jazer-cyan);
        }
        .prop-value.string {
            color: #f1fa8c;
        }
        .prop-value.number {
            color: #bd93f9;
        }
        .prop-value.boolean {
            color: #ff79c6;
        }
        .prop-value.null {
            color: #666;
        }

        /* User Journey */
        .journey-timeline {
            position: relative;
            padding-left: 1rem;
        }
        .journey-timeline::before {
            content: '';
            position: absolute;
            left: 3px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #2a2a2a;
        }
        .journey-item {
            position: relative;
            padding: 0.5rem 0 0.5rem 1rem;
            font-size: 0.75rem;
        }
        .journey-item::before {
            content: '';
            position: absolute;
            left: -1rem;
            top: 0.75rem;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #333;
            border: 2px solid #0a0a0a;
        }
        .journey-item.current::before {
            background: var(--jazer-cyan);
            box-shadow: 0 0 8px var(--jazer-cyan);
        }
        .journey-event {
            color: #fff;
        }
        .journey-time {
            color: #555;
            font-size: 0.65rem;
        }

        /* Sidebar Stats */
        .sidebar {
            width: 240px;
            background: #141414;
            border-left: 1px solid #333;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .sidebar-section {
            padding: 1rem;
            border-bottom: 1px solid #2a2a2a;
        }
        .sidebar-title {
            font-size: 0.7rem;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 0.75rem;
        }
        .event-type-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .event-type-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            padding: 0.4rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.15s ease;
        }
        .event-type-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        .event-type-item.active {
            background: rgba(0, 255, 255, 0.1);
        }
        .type-color {
            width: 10px;
            height: 10px;
            border-radius: 2px;
        }
        .type-color.page_view { background: var(--jazer-cyan); }
        .type-color.click { background: #a78bfa; }
        .type-color.form_submit { background: #39ff14; }
        .type-color.purchase { background: #ffbe0b; }
        .type-color.error { background: #ff4757; }
        .type-color.signup { background: #ec4899; }
        .type-color.search { background: #818cf8; }
        .type-name {
            flex: 1;
            color: #aaa;
        }
        .type-count {
            color: var(--jazer-cyan);
            font-weight: 600;
        }

        /* Mini Chart */
        .mini-chart {
            display: flex;
            align-items: flex-end;
            gap: 2px;
            height: 40px;
            margin-top: 0.5rem;
        }
        .mini-bar {
            flex: 1;
            background: rgba(0, 255, 255, 0.3);
            border-radius: 2px 2px 0 0;
            min-height: 4px;
            transition: height 0.3s ease;
        }
        .mini-bar:hover {
            background: var(--jazer-cyan);
        }

        /* Status Bar */
        .status-bar {
            background: #1a1a1a;
            border-top: 1px solid #333;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.7rem;
        }
        .status-info {
            display: flex;
            gap: 1.5rem;
        }
        .status-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            color: #666;
        }
        .status-item span:last-child {
            color: var(--jazer-cyan);
        }

        /* Responsive */
        @media (max-width: 1100px) {
            .sidebar {
                display: none;
            }
        }
        @media (max-width: 800px) {
            .details-panel {
                position: fixed;
                top: 0;
                right: 0;
                bottom: 0;
                width: 100%;
                max-width: 400px;
                z-index: 100;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            }
            .details-panel.visible {
                transform: translateX(0);
            }
            .item-user, .item-source {
                display: none;
            }
            .stream-col.user, .stream-col.source {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="devtools-container">
        <header class="devtools-header">
            <a href="index.html" class="back-button">‚Üê Back</a>
            <div class="header-title">Analytics Event Tracker</div>
            <div class="header-stats">
                <div class="header-stat">
                    <span class="header-stat-label">Events/min:</span>
                    <span class="header-stat-value" id="eventsPerMin">47</span>
                </div>
                <div class="header-stat">
                    <span class="header-stat-label">Active users:</span>
                    <span class="header-stat-value" id="activeUsers">1,284</span>
                </div>
            </div>
            <div class="live-indicator">
                <span class="live-dot"></span>
                <span>LIVE</span>
            </div>
        </header>

        <div class="toolbar">
            <button class="toolbar-btn recording" id="recordBtn" onclick="toggleRecording()">Recording</button>
            <button class="toolbar-btn" onclick="clearEvents()">Clear</button>
            <div class="toolbar-divider"></div>
            <input type="text" class="search-input" placeholder="Filter events..." id="searchInput" oninput="filterEvents()">
            <select class="filter-select" id="typeFilter" onchange="filterEvents()">
                <option value="all">All Types</option>
                <option value="page_view">Page Views</option>
                <option value="click">Clicks</option>
                <option value="form_submit">Form Submits</option>
                <option value="purchase">Purchases</option>
                <option value="signup">Signups</option>
                <option value="search">Searches</option>
                <option value="error">Errors</option>
            </select>
            <select class="filter-select" id="sourceFilter" onchange="filterEvents()">
                <option value="all">All Sources</option>
                <option value="web">Web</option>
                <option value="ios">iOS</option>
                <option value="android">Android</option>
                <option value="api">API</option>
            </select>
            <div class="toolbar-spacer"></div>
            <div class="event-count">
                Showing <span id="visibleCount">0</span> of <span id="totalCount">0</span> events
            </div>
        </div>

        <div class="main-content">
            <div class="stream-panel">
                <div class="stream-header">
                    <div class="stream-col time">Time</div>
                    <div class="stream-col type">Type</div>
                    <div class="stream-col name">Event Name</div>
                    <div class="stream-col user">User</div>
                    <div class="stream-col source">Source</div>
                </div>
                <div class="stream-list" id="streamList">
                    <!-- Events rendered here -->
                </div>
            </div>

            <aside class="details-panel hidden" id="detailsPanel">
                <div class="details-header">
                    <div class="details-title-group">
                        <div class="details-title" id="eventTitle">Event Details</div>
                        <div class="details-subtitle" id="eventSubtitle">--</div>
                    </div>
                    <button class="close-btn" onclick="closeDetails()">√ó</button>
                </div>
                <div class="details-content" id="detailsContent">
                    <!-- Details rendered here -->
                </div>
            </aside>

            <aside class="sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-title">Events by Type</div>
                    <div class="event-type-list" id="typeStats">
                        <!-- Type stats rendered here -->
                    </div>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-title">Events (Last 60s)</div>
                    <div class="mini-chart" id="miniChart">
                        <!-- Chart rendered here -->
                    </div>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-title">Top Events</div>
                    <div id="topEvents">
                        <!-- Top events rendered here -->
                    </div>
                </div>
            </aside>
        </div>

        <footer class="status-bar">
            <div class="status-info">
                <div class="status-item">
                    <span>Session started:</span>
                    <span id="sessionStart">--</span>
                </div>
                <div class="status-item">
                    <span>Buffer:</span>
                    <span id="bufferSize">0 events</span>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Sample event data generator
        const eventTemplates = [
            { type: 'page_view', names: ['Home Page', 'Product List', 'Product Detail', 'Cart', 'Checkout', 'Order Confirmation', 'Blog Post', 'About Us', 'Contact', 'FAQ'], props: ['page_path', 'referrer', 'title'] },
            { type: 'click', names: ['Add to Cart', 'Buy Now', 'Learn More', 'Subscribe', 'Download', 'Share', 'Like', 'Menu Toggle', 'Search Icon', 'Profile Avatar'], props: ['element_id', 'element_class', 'page'] },
            { type: 'form_submit', names: ['Contact Form', 'Newsletter Signup', 'Checkout Form', 'Login Form', 'Registration Form', 'Search Form', 'Feedback Form'], props: ['form_id', 'fields_count', 'validation_errors'] },
            { type: 'purchase', names: ['Order Completed', 'Subscription Started', 'Upgrade Plan', 'Add-on Purchased'], props: ['order_id', 'total', 'items_count', 'payment_method'] },
            { type: 'signup', names: ['Account Created', 'Email Verified', 'Profile Completed', 'Onboarding Finished'], props: ['signup_source', 'plan_type', 'referral_code'] },
            { type: 'search', names: ['Product Search', 'Site Search', 'Filter Applied', 'Sort Changed'], props: ['query', 'results_count', 'filters'] },
            { type: 'error', names: ['JavaScript Error', 'API Error', 'Payment Failed', 'Form Validation Error', '404 Not Found'], props: ['error_message', 'stack_trace', 'url'] }
        ];

        const users = [
            { id: 'usr_8f2k9', name: 'john.doe@email.com' },
            { id: 'usr_3j7m2', name: 'sarah.smith@corp.io' },
            { id: 'usr_9p4x6', name: 'mike.johnson@mail.net' },
            { id: 'usr_2w8n1', name: 'emma.wilson@company.com' },
            { id: 'usr_5k3v7', name: 'alex.kumar@startup.io' },
            { id: 'anon_7h2', name: 'Anonymous' },
            { id: 'anon_4f9', name: 'Anonymous' },
            { id: 'usr_1m6b8', name: 'lisa.chen@enterprise.com' }
        ];

        const sources = ['web', 'ios', 'android', 'api'];

        let events = [];
        let filteredEvents = [];
        let selectedEvent = null;
        let isRecording = true;
        let eventId = 0;
        let chartData = new Array(30).fill(0);

        // Generate initial events
        function generateEvent() {
            const template = eventTemplates[Math.floor(Math.random() * eventTemplates.length)];
            const user = users[Math.floor(Math.random() * users.length)];
            const source = sources[Math.floor(Math.random() * sources.length)];
            const name = template.names[Math.floor(Math.random() * template.names.length)];

            const properties = {};
            template.props.forEach(prop => {
                properties[prop] = generatePropValue(prop, template.type, name);
            });

            // Add common properties
            properties.session_id = `sess_${Math.random().toString(36).substr(2, 8)}`;
            properties.timestamp = Date.now();
            properties.user_agent = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)';

            return {
                id: `evt_${++eventId}`,
                type: template.type,
                name: name,
                user: user,
                source: source,
                properties: properties,
                timestamp: new Date(),
                isNew: true
            };
        }

        function generatePropValue(prop, type, name) {
            const values = {
                page_path: ['/home', '/products', '/products/12345', '/cart', '/checkout', '/blog/article-1'],
                referrer: ['https://google.com', 'https://facebook.com', 'direct', 'https://twitter.com'],
                title: ['Welcome | MyApp', 'Products | MyApp', 'Shopping Cart', 'Checkout'],
                element_id: ['btn-add-cart', 'btn-buy-now', 'link-learn-more', 'btn-subscribe'],
                element_class: ['primary-btn', 'cta-button', 'nav-link', 'action-btn'],
                page: ['/home', '/products', '/checkout'],
                form_id: ['contact-form', 'signup-form', 'checkout-form'],
                fields_count: [3, 5, 8, 12],
                validation_errors: [0, 1, 2],
                order_id: [`ORD-${Math.floor(Math.random() * 100000)}`],
                total: [(Math.random() * 500 + 10).toFixed(2)],
                items_count: [1, 2, 3, 5],
                payment_method: ['credit_card', 'paypal', 'apple_pay', 'google_pay'],
                signup_source: ['organic', 'paid_ad', 'referral', 'social'],
                plan_type: ['free', 'starter', 'pro', 'enterprise'],
                referral_code: [null, 'FRIEND20', 'WELCOME10'],
                query: ['blue shoes', 'laptop', 'headphones', 'iphone case'],
                results_count: [0, 5, 23, 156],
                filters: [{ category: 'electronics' }, { price: '50-100' }],
                error_message: ['Cannot read property of undefined', 'Network request failed', 'Payment declined'],
                stack_trace: ['at handleClick (app.js:234)', 'at fetchData (api.js:89)'],
                url: ['/checkout', '/api/payment', '/products/99999']
            };

            const options = values[prop] || ['value'];
            const val = options[Math.floor(Math.random() * options.length)];
            return typeof val === 'object' ? val : val;
        }

        // Initialize with some events
        function initEvents() {
            for (let i = 0; i < 25; i++) {
                const event = generateEvent();
                event.timestamp = new Date(Date.now() - Math.random() * 60000);
                event.isNew = false;
                events.unshift(event);
            }
            events.sort((a, b) => b.timestamp - a.timestamp);
            filterEvents();
            updateStats();
        }

        // Render events
        function renderEvents() {
            const list = document.getElementById('streamList');
            list.innerHTML = filteredEvents.map(event => `
                <div class="stream-item ${selectedEvent?.id === event.id ? 'selected' : ''} ${event.isNew ? 'new' : ''}" 
                     data-id="${event.id}" onclick="selectEvent('${event.id}')">
                    <div class="item-time">${formatTime(event.timestamp)}</div>
                    <div class="item-type">
                        <span class="type-badge ${event.type}">${formatType(event.type)}</span>
                    </div>
                    <div class="item-name">${event.name}</div>
                    <div class="item-user" title="${event.user.name}">${event.user.name}</div>
                    <div class="item-source">
                        <span class="source-badge ${event.source}">${event.source.toUpperCase()}</span>
                    </div>
                </div>
            `).join('');

            // Remove 'new' class after animation
            setTimeout(() => {
                events.forEach(e => e.isNew = false);
            }, 500);

            document.getElementById('visibleCount').textContent = filteredEvents.length;
            document.getElementById('totalCount').textContent = events.length;
        }

        function formatTime(date) {
            return date.toLocaleTimeString('en-US', { hour12: false });
        }

        function formatType(type) {
            return type.replace('_', ' ');
        }

        // Select event
        function selectEvent(id) {
            selectedEvent = events.find(e => e.id === id);
            renderEvents();
            renderDetails();
            document.getElementById('detailsPanel').classList.remove('hidden');
            document.getElementById('detailsPanel').classList.add('visible');
        }

        function closeDetails() {
            selectedEvent = null;
            document.getElementById('detailsPanel').classList.add('hidden');
            document.getElementById('detailsPanel').classList.remove('visible');
            renderEvents();
        }

        // Render event details
        function renderDetails() {
            if (!selectedEvent) return;
            const e = selectedEvent;

            document.getElementById('eventTitle').textContent = e.name;
            document.getElementById('eventSubtitle').textContent = `${e.id} ‚Ä¢ ${formatType(e.type)}`;

            // Get user journey (recent events from same user)
            const userEvents = events.filter(ev => ev.user.id === e.user.id).slice(0, 5);

            document.getElementById('detailsContent').innerHTML = `
                <div class="detail-section">
                    <div class="detail-section-title">Event Info</div>
                    <div class="detail-row">
                        <span class="detail-label">Event ID</span>
                        <span class="detail-value">${e.id}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Type</span>
                        <span class="detail-value">${formatType(e.type)}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Timestamp</span>
                        <span class="detail-value">${e.timestamp.toISOString()}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Source</span>
                        <span class="detail-value">${e.source.toUpperCase()}</span>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-section-title">User</div>
                    <div class="detail-row">
                        <span class="detail-label">User ID</span>
                        <span class="detail-value">${e.user.id}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Identity</span>
                        <span class="detail-value">${e.user.name}</span>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-section-title">Properties</div>
                    <div class="properties-tree">
                        ${renderProperties(e.properties)}
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-section-title">User Journey</div>
                    <div class="journey-timeline">
                        ${userEvents.map((ev, i) => `
                            <div class="journey-item ${ev.id === e.id ? 'current' : ''}">
                                <div class="journey-event">${ev.name}</div>
                                <div class="journey-time">${formatTime(ev.timestamp)}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderProperties(props, indent = 0) {
            return Object.entries(props).map(([key, value]) => {
                const valueType = typeof value;
                let valueClass = valueType;
                let displayValue = value;

                if (value === null) {
                    valueClass = 'null';
                    displayValue = 'null';
                } else if (typeof value === 'object') {
                    return `
                        <div class="prop-item">
                            <span class="prop-key">${key}:</span>
                            <span class="prop-value">{</span>
                        </div>
                        ${renderProperties(value, indent + 1)}
                        <div class="prop-item">
                            <span class="prop-value">}</span>
                        </div>
                    `;
                } else if (typeof value === 'string') {
                    displayValue = `"${value}"`;
                }

                return `
                    <div class="prop-item ${indent > 0 ? 'nested' : ''}">
                        <span class="prop-key">${key}:</span>
                        <span class="prop-value ${valueClass}">${displayValue}</span>
                    </div>
                `;
            }).join('');
        }

        // Filter events
        function filterEvents() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value;
            const sourceFilter = document.getElementById('sourceFilter').value;

            filteredEvents = events.filter(e => {
                const matchesSearch = e.name.toLowerCase().includes(search) || 
                                     e.user.name.toLowerCase().includes(search) ||
                                     e.id.toLowerCase().includes(search);
                const matchesType = typeFilter === 'all' || e.type === typeFilter;
                const matchesSource = sourceFilter === 'all' || e.source === sourceFilter;
                return matchesSearch && matchesType && matchesSource;
            });

            renderEvents();
        }

        // Update sidebar stats
        function updateStats() {
            // Type counts
            const typeCounts = {};
            events.forEach(e => {
                typeCounts[e.type] = (typeCounts[e.type] || 0) + 1;
            });

            const typeStatsEl = document.getElementById('typeStats');
            typeStatsEl.innerHTML = Object.entries(typeCounts)
                .sort((a, b) => b[1] - a[1])
                .map(([type, count]) => `
                    <div class="event-type-item" onclick="filterByType('${type}')">
                        <span class="type-color ${type}"></span>
                        <span class="type-name">${formatType(type)}</span>
                        <span class="type-count">${count}</span>
                    </div>
                `).join('');

            // Top events
            const eventCounts = {};
            events.forEach(e => {
                eventCounts[e.name] = (eventCounts[e.name] || 0) + 1;
            });

            const topEventsEl = document.getElementById('topEvents');
            topEventsEl.innerHTML = Object.entries(eventCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .map(([name, count]) => `
                    <div class="event-type-item">
                        <span class="type-name">${name}</span>
                        <span class="type-count">${count}</span>
                    </div>
                `).join('');

            // Mini chart
            renderMiniChart();
        }

        function renderMiniChart() {
            const maxVal = Math.max(...chartData, 1);
            document.getElementById('miniChart').innerHTML = chartData.map(val => 
                `<div class="mini-bar" style="height: ${(val / maxVal) * 100}%"></div>`
            ).join('');
        }

        function filterByType(type) {
            document.getElementById('typeFilter').value = type;
            filterEvents();
        }

        // Recording controls
        function toggleRecording() {
            isRecording = !isRecording;
            const btn = document.getElementById('recordBtn');
            if (isRecording) {
                btn.classList.add('recording');
                btn.textContent = 'Recording';
            } else {
                btn.classList.remove('recording');
                btn.textContent = 'Paused';
            }
        }

        function clearEvents() {
            events = [];
            filteredEvents = [];
            selectedEvent = null;
            chartData = new Array(30).fill(0);
            filterEvents();
            updateStats();
            closeDetails();
        }

        // Simulate live events
        function simulateLiveEvent() {
            if (!isRecording) return;

            const event = generateEvent();
            events.unshift(event);

            // Keep max 500 events
            if (events.length > 500) {
                events = events.slice(0, 500);
            }

            // Update chart data
            chartData.shift();
            chartData.push((chartData[chartData.length - 1] || 0) + 1);

            filterEvents();
            updateStats();

            // Update header stats
            document.getElementById('eventsPerMin').textContent = Math.floor(Math.random() * 30 + 30);
            document.getElementById('activeUsers').textContent = (1200 + Math.floor(Math.random() * 200)).toLocaleString();
            document.getElementById('bufferSize').textContent = `${events.length} events`;
        }

        // Initialize
        initEvents();
        document.getElementById('sessionStart').textContent = new Date().toLocaleTimeString();

        // Start live simulation
        setInterval(simulateLiveEvent, Math.random() * 2000 + 1000);

        // Reset chart periodically
        setInterval(() => {
            chartData.shift();
            chartData.push(0);
            renderMiniChart();
        }, 2000);
    </script>
</body>
</html>
