<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SessionStorage Viewer - JaZeR DevTools</title>
    <link rel="stylesheet" href="../../../jazer-brand.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Courier New', monospace; 
            background: #0a0a0a;
            min-height: 100vh; 
            color: #e0e0e0;
        }
        .devtools-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .devtools-header {
            background: #1a1a1a;
            border-bottom: 2px solid var(--jazer-purple);
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--jazer-purple);
            text-decoration: none;
            padding: 0.4rem 0.8rem;
            border: 1px solid var(--jazer-purple);
            border-radius: 4px;
            background: rgba(147, 51, 234, 0.1);
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }
        .back-button:hover {
            background: var(--jazer-purple);
            color: #0a0a0a;
        }
        .header-title {
            font-size: 1rem;
            color: var(--jazer-purple);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .header-title::before {
            content: '';
            width: 8px;
            height: 8px;
            background: var(--jazer-purple);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 4px var(--jazer-purple); }
            50% { opacity: 0.5; box-shadow: 0 0 12px var(--jazer-purple); }
        }
        .session-badge {
            background: rgba(147, 51, 234, 0.2);
            border: 1px solid var(--jazer-purple);
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            font-size: 0.65rem;
            color: var(--jazer-purple);
            text-transform: uppercase;
            font-weight: 600;
        }
        .header-stats {
            display: flex;
            gap: 1.5rem;
            margin-left: auto;
            font-size: 0.75rem;
        }
        .header-stat {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        .header-stat-label { color: #666; }
        .header-stat-value { color: var(--jazer-purple); font-weight: 600; }

        /* Session Warning Banner */
        .session-warning {
            background: linear-gradient(90deg, rgba(147, 51, 234, 0.1), rgba(236, 72, 153, 0.1));
            border-bottom: 1px solid rgba(147, 51, 234, 0.3);
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.75rem;
        }
        .warning-icon {
            color: #ffbe0b;
        }
        .warning-text {
            color: #aaa;
        }
        .warning-text strong {
            color: var(--jazer-purple);
        }
        .session-timer {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #666;
        }
        .timer-value {
            font-family: 'Courier New', monospace;
            color: var(--jazer-purple);
            font-weight: 600;
        }

        /* Toolbar */
        .toolbar {
            background: #141414;
            border-bottom: 1px solid #333;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .search-input {
            padding: 0.4rem 0.8rem;
            font-size: 0.75rem;
            border-radius: 4px;
            border: 1px solid #444;
            background: #0a0a0a;
            color: #e0e0e0;
            font-family: inherit;
            width: 250px;
        }
        .search-input:focus {
            outline: none;
            border-color: var(--jazer-purple);
        }
        .toolbar-btn {
            padding: 0.4rem 0.8rem;
            font-size: 0.75rem;
            border-radius: 4px;
            border: 1px solid #444;
            background: #1a1a1a;
            color: #aaa;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        .toolbar-btn:hover {
            border-color: var(--jazer-purple);
            color: var(--jazer-purple);
        }
        .toolbar-btn.danger:hover {
            border-color: #ff4757;
            color: #ff4757;
        }
        .toolbar-btn.primary {
            background: var(--jazer-purple);
            border-color: var(--jazer-purple);
            color: white;
            font-weight: 600;
        }
        .filter-select {
            padding: 0.4rem 0.8rem;
            font-size: 0.75rem;
            border-radius: 4px;
            border: 1px solid #444;
            background: #1a1a1a;
            color: #aaa;
            font-family: inherit;
            cursor: pointer;
        }
        .filter-select:focus {
            outline: none;
            border-color: var(--jazer-purple);
        }
        .toolbar-spacer { flex: 1; }
        .item-count {
            font-size: 0.75rem;
            color: #666;
        }
        .item-count span { color: var(--jazer-purple); font-weight: 600; }

        /* Main Layout */
        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* Categories Sidebar */
        .categories-sidebar {
            width: 200px;
            background: #111;
            border-right: 1px solid #2a2a2a;
            overflow-y: auto;
        }
        .category-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #1a1a1a;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            font-size: 0.8rem;
        }
        .category-item:hover {
            background: rgba(147, 51, 234, 0.1);
        }
        .category-item.active {
            background: rgba(147, 51, 234, 0.15);
            border-left: 3px solid var(--jazer-purple);
        }
        .category-name {
            color: #aaa;
        }
        .category-item.active .category-name {
            color: var(--jazer-purple);
        }
        .category-count {
            background: #2a2a2a;
            padding: 0.15rem 0.5rem;
            border-radius: 10px;
            font-size: 0.65rem;
            color: #888;
        }
        .category-item.active .category-count {
            background: var(--jazer-purple);
            color: white;
        }

        /* Storage Table */
        .table-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .table-header {
            display: flex;
            background: #141414;
            border-bottom: 1px solid #333;
            font-size: 0.7rem;
            color: #666;
            text-transform: uppercase;
        }
        .table-header-cell {
            padding: 0.75rem 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            user-select: none;
            transition: color 0.2s ease;
        }
        .table-header-cell:hover {
            color: #aaa;
        }
        .table-header-cell.sorted {
            color: var(--jazer-purple);
        }
        .table-header-cell.key { flex: 0 0 220px; }
        .table-header-cell.value { flex: 1; }
        .table-header-cell.type { flex: 0 0 80px; }
        .table-header-cell.size { flex: 0 0 80px; text-align: right; }
        .table-header-cell.age { flex: 0 0 100px; }
        .table-header-cell.actions { flex: 0 0 100px; }
        .sort-icon {
            font-size: 0.6rem;
        }

        .table-body {
            flex: 1;
            overflow-y: auto;
        }
        .table-row {
            display: flex;
            border-bottom: 1px solid #1a1a1a;
            transition: background 0.15s ease;
            cursor: pointer;
        }
        .table-row:hover {
            background: rgba(255, 255, 255, 0.03);
        }
        .table-row.selected {
            background: rgba(147, 51, 234, 0.1);
        }
        .table-row.expired {
            opacity: 0.5;
        }
        .table-cell {
            padding: 0.75rem 1rem;
            font-size: 0.8rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .table-cell.key {
            flex: 0 0 220px;
            color: #bd93f9;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .key-icon {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }
        .table-cell.value {
            flex: 1;
            color: #888;
            font-family: 'Courier New', monospace;
        }
        .table-cell.type {
            flex: 0 0 80px;
        }
        .table-cell.size {
            flex: 0 0 80px;
            text-align: right;
            color: #666;
        }
        .table-cell.age {
            flex: 0 0 100px;
            color: #666;
            font-size: 0.75rem;
        }
        .table-cell.actions {
            flex: 0 0 100px;
            display: flex;
            gap: 0.5rem;
            opacity: 0;
            transition: opacity 0.15s ease;
        }
        .table-row:hover .table-cell.actions {
            opacity: 1;
        }
        .action-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 0.8rem;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
        }
        .action-btn:hover { color: var(--jazer-purple); background: rgba(147, 51, 234, 0.1); }
        .action-btn.delete:hover { color: #ff4757; background: rgba(255, 71, 87, 0.1); }

        /* Detail Panel */
        .detail-panel {
            width: 380px;
            background: #141414;
            border-left: 1px solid #333;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .detail-panel.hidden { display: none; }
        .detail-header {
            padding: 1rem;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(180deg, #1a1a1a, #141414);
        }
        .detail-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #fff;
        }
        .close-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 1.2rem;
        }
        .close-btn:hover { color: #fff; }
        .detail-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        .detail-section {
            margin-bottom: 1.5rem;
        }
        .detail-section-title {
            font-size: 0.7rem;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #2a2a2a;
        }
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 0.4rem 0;
            font-size: 0.8rem;
        }
        .detail-label { color: #888; }
        .detail-value { color: #fff; font-weight: 500; }
        .detail-key-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            font-size: 0.8rem;
            border-radius: 4px;
            border: 1px solid #333;
            background: #0f0f0f;
            color: #bd93f9;
            font-family: inherit;
            margin-bottom: 1rem;
        }
        .detail-key-input:focus {
            outline: none;
            border-color: var(--jazer-purple);
        }
        .detail-value-editor {
            width: 100%;
            min-height: 180px;
            padding: 0.75rem;
            font-size: 0.8rem;
            border-radius: 6px;
            border: 1px solid #333;
            background: #0f0f0f;
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
            resize: vertical;
            line-height: 1.5;
        }
        .detail-value-editor:focus {
            outline: none;
            border-color: var(--jazer-purple);
        }
        .detail-footer {
            padding: 1rem;
            border-top: 1px solid #333;
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }
        .detail-btn {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            border-radius: 4px;
            border: 1px solid #444;
            background: transparent;
            color: #aaa;
            cursor: pointer;
            font-family: inherit;
        }
        .detail-btn:hover {
            border-color: var(--jazer-purple);
            color: var(--jazer-purple);
        }
        .detail-btn.primary {
            background: var(--jazer-purple);
            border-color: var(--jazer-purple);
            color: white;
            font-weight: 600;
        }
        .detail-btn.danger {
            border-color: #ff4757;
            color: #ff4757;
        }
        .detail-btn.danger:hover {
            background: rgba(255, 71, 87, 0.2);
        }

        /* JSON Viewer */
        .json-viewer {
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            line-height: 1.5;
            background: #0f0f0f;
            border-radius: 6px;
            padding: 0.75rem;
            max-height: 250px;
            overflow: auto;
            border: 1px solid #2a2a2a;
        }
        .json-key { color: #bd93f9; }
        .json-string { color: #f1fa8c; }
        .json-number { color: #ff79c6; }
        .json-boolean { color: #50fa7b; }
        .json-null { color: #666; }

        /* Value Type Badge */
        .type-badge {
            display: inline-block;
            padding: 0.15rem 0.4rem;
            border-radius: 3px;
            font-size: 0.6rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .type-badge.string { background: rgba(241, 250, 140, 0.2); color: #f1fa8c; }
        .type-badge.object { background: rgba(139, 233, 253, 0.2); color: #8be9fd; }
        .type-badge.array { background: rgba(189, 147, 249, 0.2); color: #bd93f9; }
        .type-badge.number { background: rgba(255, 121, 198, 0.2); color: #ff79c6; }
        .type-badge.boolean { background: rgba(80, 250, 123, 0.2); color: #50fa7b; }

        /* Status Bar */
        .status-bar {
            background: #1a1a1a;
            border-top: 1px solid #333;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.7rem;
        }
        .status-info {
            display: flex;
            gap: 1.5rem;
        }
        .status-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            color: #666;
        }
        .status-item span:last-child {
            color: var(--jazer-purple);
        }
        .session-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #50fa7b;
            animation: statusPulse 2s ease-in-out infinite;
        }
        @keyframes statusPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        .status-dot.warning { background: #ffbe0b; }
        .status-dot.danger { background: #ff4757; }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #555;
            text-align: center;
            padding: 2rem;
        }
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Tab indicator for session-specific data */
        .tab-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.3rem 0.6rem;
            background: rgba(147, 51, 234, 0.1);
            border: 1px solid rgba(147, 51, 234, 0.3);
            border-radius: 4px;
            font-size: 0.7rem;
        }
        .tab-id {
            color: var(--jazer-purple);
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 1100px) {
            .categories-sidebar { display: none; }
        }
        @media (max-width: 900px) {
            .detail-panel {
                position: fixed;
                top: 0;
                right: 0;
                bottom: 0;
                width: 100%;
                max-width: 380px;
                z-index: 100;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            }
            .detail-panel.visible {
                transform: translateX(0);
            }
            .table-cell.size { display: none; }
            .table-header-cell.size { display: none; }
            .table-cell.age { display: none; }
            .table-header-cell.age { display: none; }
        }
    </style>
</head>
<body>
    <div class="devtools-container">
        <header class="devtools-header">
            <a href="index.html" class="back-button">‚Üê Back</a>
            <div class="header-title">SessionStorage Viewer</div>
            <span class="session-badge">Tab-Scoped</span>
            <div class="header-stats">
                <div class="header-stat">
                    <span class="header-stat-label">Items:</span>
                    <span class="header-stat-value" id="totalItems">15</span>
                </div>
                <div class="header-stat">
                    <span class="header-stat-label">Size:</span>
                    <span class="header-stat-value" id="totalSize">2.8 KB</span>
                </div>
            </div>
        </header>

        <div class="session-warning">
            <span class="warning-icon">‚ö†</span>
            <span class="warning-text">
                <strong>Session data</strong> persists only for this browser tab. Closing the tab will clear all data below.
            </span>
            <div class="session-timer">
                <span>Session active:</span>
                <span class="timer-value" id="sessionTimer">00:05:32</span>
            </div>
        </div>

        <div class="toolbar">
            <input type="text" class="search-input" placeholder="Search keys or values..." id="searchInput" oninput="filterItems()">
            <select class="filter-select" id="typeFilter" onchange="filterItems()">
                <option value="all">All Types</option>
                <option value="object">Objects</option>
                <option value="array">Arrays</option>
                <option value="string">Strings</option>
                <option value="number">Numbers</option>
                <option value="boolean">Booleans</option>
            </select>
            <button class="toolbar-btn" onclick="refreshData()">‚Üª Refresh</button>
            <button class="toolbar-btn" onclick="exportData()">‚¨á Export</button>
            <div class="toolbar-spacer"></div>
            <div class="tab-indicator">
                <span>Tab ID:</span>
                <span class="tab-id" id="tabId">tab_a7f3c9</span>
            </div>
            <div class="item-count">
                Showing <span id="visibleCount">15</span> items
            </div>
            <button class="toolbar-btn danger" onclick="clearAll()">Clear All</button>
            <button class="toolbar-btn primary" onclick="addItem()">+ Add</button>
        </div>

        <div class="main-content">
            <aside class="categories-sidebar">
                <div class="category-item active" onclick="filterByCategory('all')">
                    <span class="category-name">All Items</span>
                    <span class="category-count" id="countAll">15</span>
                </div>
                <div class="category-item" onclick="filterByCategory('navigation')">
                    <span class="category-name">Navigation</span>
                    <span class="category-count" id="countNavigation">4</span>
                </div>
                <div class="category-item" onclick="filterByCategory('form')">
                    <span class="category-name">Form State</span>
                    <span class="category-count" id="countForm">3</span>
                </div>
                <div class="category-item" onclick="filterByCategory('ui')">
                    <span class="category-name">UI State</span>
                    <span class="category-count" id="countUi">4</span>
                </div>
                <div class="category-item" onclick="filterByCategory('temp')">
                    <span class="category-name">Temp Data</span>
                    <span class="category-count" id="countTemp">2</span>
                </div>
                <div class="category-item" onclick="filterByCategory('wizard')">
                    <span class="category-name">Wizard Steps</span>
                    <span class="category-count" id="countWizard">2</span>
                </div>
            </aside>

            <div class="table-panel">
                <div class="table-header">
                    <div class="table-header-cell key sorted" onclick="sortBy('key')">
                        Key <span class="sort-icon">‚ñº</span>
                    </div>
                    <div class="table-header-cell value" onclick="sortBy('value')">
                        Value <span class="sort-icon"></span>
                    </div>
                    <div class="table-header-cell type" onclick="sortBy('type')">
                        Type <span class="sort-icon"></span>
                    </div>
                    <div class="table-header-cell size" onclick="sortBy('size')">
                        Size <span class="sort-icon"></span>
                    </div>
                    <div class="table-header-cell age" onclick="sortBy('age')">
                        Age <span class="sort-icon"></span>
                    </div>
                    <div class="table-header-cell actions">Actions</div>
                </div>
                <div class="table-body" id="tableBody">
                    <!-- Items rendered here -->
                </div>
            </div>

            <aside class="detail-panel hidden" id="detailPanel">
                <div class="detail-header">
                    <span class="detail-title" id="detailTitle">Edit Item</span>
                    <button class="close-btn" onclick="closeDetail()">√ó</button>
                </div>
                <div class="detail-content">
                    <div class="detail-section">
                        <div class="detail-section-title">Key</div>
                        <input type="text" class="detail-key-input" id="detailKey" placeholder="Enter key name">
                    </div>
                    <div class="detail-section">
                        <div class="detail-section-title">Value</div>
                        <textarea class="detail-value-editor" id="detailValue" placeholder="Enter value (JSON or string)"></textarea>
                    </div>
                    <div class="detail-section">
                        <div class="detail-section-title">Metadata</div>
                        <div class="detail-row">
                            <span class="detail-label">Type</span>
                            <span class="detail-value" id="detailType">--</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Size</span>
                            <span class="detail-value" id="detailSize">--</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Category</span>
                            <span class="detail-value" id="detailCategory">--</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Created</span>
                            <span class="detail-value" id="detailCreated">--</span>
                        </div>
                    </div>
                    <div class="detail-section" id="jsonPreview" style="display: none;">
                        <div class="detail-section-title">JSON Preview</div>
                        <div class="json-viewer" id="jsonViewer"></div>
                    </div>
                </div>
                <div class="detail-footer">
                    <button class="detail-btn danger" onclick="deleteItem()" id="deleteBtn">Delete</button>
                    <button class="detail-btn" onclick="closeDetail()">Cancel</button>
                    <button class="detail-btn primary" onclick="saveItem()">Save</button>
                </div>
            </aside>
        </div>

        <footer class="status-bar">
            <div class="status-info">
                <div class="status-item">
                    <span>Storage scope:</span>
                    <span>Tab-only</span>
                </div>
                <div class="status-item">
                    <span>Quota used:</span>
                    <span id="quotaPercent">0.05%</span>
                </div>
                <div class="status-item">
                    <span>Last refresh:</span>
                    <span id="lastRefresh">--</span>
                </div>
            </div>
            <div class="session-status">
                <span class="status-dot"></span>
                <span style="color: #50fa7b;">Session Active</span>
            </div>
        </footer>
    </div>

    <script>
        // Session-specific storage data (simulated)
        let storageItems = [
            // Navigation state
            { key: 'nav_history', value: JSON.stringify(['/home', '/products', '/products/123', '/cart']), category: 'navigation', created: Date.now() - 280000 },
            { key: 'scroll_positions', value: JSON.stringify({ '/products': 450, '/cart': 0, '/home': 1200 }), category: 'navigation', created: Date.now() - 240000 },
            { key: 'current_route', value: '/cart', category: 'navigation', created: Date.now() - 30000 },
            { key: 'breadcrumb_trail', value: JSON.stringify(['Home', 'Products', 'Electronics', 'Cart']), category: 'navigation', created: Date.now() - 30000 },
            
            // Form state
            { key: 'checkout_form', value: JSON.stringify({ step: 2, shipping: { name: 'John Doe', address: '123 Main St' }, billing: null }), category: 'form', created: Date.now() - 120000 },
            { key: 'search_filters', value: JSON.stringify({ category: 'electronics', priceMin: 50, priceMax: 500, sortBy: 'price-asc' }), category: 'form', created: Date.now() - 180000 },
            { key: 'draft_review', value: JSON.stringify({ productId: 123, rating: 4, comment: 'Great product, fast shipping...' }), category: 'form', created: Date.now() - 90000 },
            
            // UI state
            { key: 'sidebar_expanded', value: 'true', category: 'ui', created: Date.now() - 300000 },
            { key: 'active_tab', value: 'specifications', category: 'ui', created: Date.now() - 60000 },
            { key: 'modal_dismissed', value: JSON.stringify(['promo-banner', 'cookie-notice']), category: 'ui', created: Date.now() - 200000 },
            { key: 'grid_view_mode', value: 'list', category: 'ui', created: Date.now() - 150000 },
            
            // Temp data
            { key: 'temp_comparison', value: JSON.stringify([{ id: 101, name: 'Product A' }, { id: 102, name: 'Product B' }]), category: 'temp', created: Date.now() - 45000 },
            { key: 'clipboard_data', value: 'SKU-12345-XL', category: 'temp', created: Date.now() - 15000 },
            
            // Wizard steps
            { key: 'wizard_onboarding', value: JSON.stringify({ currentStep: 3, completed: [1, 2], skipped: [], data: { name: 'John', preferences: ['tech', 'sports'] } }), category: 'wizard', created: Date.now() - 100000 },
            { key: 'wizard_profile_setup', value: JSON.stringify({ step: 'avatar', progress: 60 }), category: 'wizard', created: Date.now() - 75000 }
        ];

        let filteredItems = [...storageItems];
        let selectedItem = null;
        let isNewItem = false;
        let sortField = 'key';
        let sortDirection = 'asc';
        let activeCategory = 'all';
        let sessionStartTime = Date.now() - 332000; // ~5.5 minutes ago

        // Calculate size of a string in bytes
        function getByteSize(str) {
            return new Blob([str]).size;
        }

        function formatBytes(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }

        function getValueType(value) {
            try {
                const parsed = JSON.parse(value);
                if (Array.isArray(parsed)) return 'array';
                if (typeof parsed === 'object' && parsed !== null) return 'object';
                if (typeof parsed === 'number') return 'number';
                if (typeof parsed === 'boolean') return 'boolean';
                return 'string';
            } catch {
                if (value === 'true' || value === 'false') return 'boolean';
                if (!isNaN(value) && value.trim() !== '') return 'number';
                return 'string';
            }
        }

        function formatTimeAgo(timestamp) {
            const diff = Date.now() - timestamp;
            if (diff < 60000) return Math.floor(diff / 1000) + 's ago';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'm ago';
            return Math.floor(diff / 3600000) + 'h ago';
        }

        function formatDuration(ms) {
            const seconds = Math.floor(ms / 1000) % 60;
            const minutes = Math.floor(ms / 60000) % 60;
            const hours = Math.floor(ms / 3600000);
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function getCategoryIcon(category) {
            const icons = {
                navigation: 'üß≠',
                form: 'üìù',
                ui: 'üé®',
                temp: '‚è±',
                wizard: 'üßô'
            };
            return icons[category] || 'üì¶';
        }

        // Update session timer
        function updateSessionTimer() {
            const elapsed = Date.now() - sessionStartTime;
            document.getElementById('sessionTimer').textContent = formatDuration(elapsed);
        }
        setInterval(updateSessionTimer, 1000);

        // Render table
        function renderTable() {
            const tbody = document.getElementById('tableBody');
            
            if (filteredItems.length === 0) {
                tbody.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <div>No session items found</div>
                    </div>
                `;
                return;
            }

            tbody.innerHTML = filteredItems.map((item, index) => {
                const size = getByteSize(item.value);
                const type = getValueType(item.value);
                const displayValue = item.value.length > 80 ? item.value.substring(0, 80) + '...' : item.value;

                return `
                    <div class="table-row ${selectedItem?.key === item.key ? 'selected' : ''}" onclick="selectItem(${index})">
                        <div class="table-cell key">
                            <span class="key-icon">${getCategoryIcon(item.category)}</span>
                            ${escapeHtml(item.key)}
                        </div>
                        <div class="table-cell value">${escapeHtml(displayValue)}</div>
                        <div class="table-cell type">
                            <span class="type-badge ${type}">${type}</span>
                        </div>
                        <div class="table-cell size">${formatBytes(size)}</div>
                        <div class="table-cell age">${formatTimeAgo(item.created)}</div>
                        <div class="table-cell actions">
                            <button class="action-btn" onclick="event.stopPropagation(); editItem(${index})" title="Edit">‚úèÔ∏è</button>
                            <button class="action-btn" onclick="event.stopPropagation(); copyValue(${index})" title="Copy">üìã</button>
                            <button class="action-btn delete" onclick="event.stopPropagation(); deleteItemByIndex(${index})" title="Delete">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            }).join('');

            updateStats();
            updateCategoryCounts();
        }

        function escapeHtml(str) {
            return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }

        function updateStats() {
            const totalSize = storageItems.reduce((sum, item) => sum + getByteSize(item.value), 0);
            const quotaPercent = (totalSize / (5 * 1024 * 1024) * 100).toFixed(2);

            document.getElementById('totalItems').textContent = storageItems.length;
            document.getElementById('totalSize').textContent = formatBytes(totalSize);
            document.getElementById('visibleCount').textContent = filteredItems.length;
            document.getElementById('quotaPercent').textContent = quotaPercent + '%';
        }

        function updateCategoryCounts() {
            const counts = {
                all: storageItems.length,
                navigation: 0,
                form: 0,
                ui: 0,
                temp: 0,
                wizard: 0
            };
            
            storageItems.forEach(item => {
                if (counts.hasOwnProperty(item.category)) {
                    counts[item.category]++;
                }
            });

            document.getElementById('countAll').textContent = counts.all;
            document.getElementById('countNavigation').textContent = counts.navigation;
            document.getElementById('countForm').textContent = counts.form;
            document.getElementById('countUi').textContent = counts.ui;
            document.getElementById('countTemp').textContent = counts.temp;
            document.getElementById('countWizard').textContent = counts.wizard;
        }

        // Filter items
        function filterItems() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value;
            
            filteredItems = storageItems.filter(item => {
                const matchesSearch = item.key.toLowerCase().includes(search) || 
                                      item.value.toLowerCase().includes(search);
                const matchesType = typeFilter === 'all' || getValueType(item.value) === typeFilter;
                const matchesCategory = activeCategory === 'all' || item.category === activeCategory;
                return matchesSearch && matchesType && matchesCategory;
            });
            sortItems();
            renderTable();
        }

        function filterByCategory(category) {
            activeCategory = category;
            
            document.querySelectorAll('.category-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            filterItems();
        }

        // Sort items
        function sortBy(field) {
            if (sortField === field) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortField = field;
                sortDirection = 'asc';
            }

            document.querySelectorAll('.table-header-cell').forEach(cell => {
                cell.classList.remove('sorted');
                const icon = cell.querySelector('.sort-icon');
                if (icon) icon.textContent = '';
            });

            const headerClasses = { key: 'key', value: 'value', type: 'type', size: 'size', age: 'age' };
            const header = document.querySelector(`.table-header-cell.${headerClasses[field]}`);
            if (header) {
                header.classList.add('sorted');
                const icon = header.querySelector('.sort-icon');
                if (icon) icon.textContent = sortDirection === 'asc' ? '‚ñº' : '‚ñ≤';
            }

            sortItems();
            renderTable();
        }

        function sortItems() {
            filteredItems.sort((a, b) => {
                let aVal, bVal;
                if (sortField === 'key') {
                    aVal = a.key.toLowerCase();
                    bVal = b.key.toLowerCase();
                } else if (sortField === 'value') {
                    aVal = a.value.toLowerCase();
                    bVal = b.value.toLowerCase();
                } else if (sortField === 'type') {
                    aVal = getValueType(a.value);
                    bVal = getValueType(b.value);
                } else if (sortField === 'size') {
                    aVal = getByteSize(a.value);
                    bVal = getByteSize(b.value);
                } else if (sortField === 'age') {
                    aVal = a.created;
                    bVal = b.created;
                }
                
                if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;
                if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;
                return 0;
            });
        }

        // Select and edit items
        function selectItem(index) {
            selectedItem = filteredItems[index];
            renderTable();
            showDetail();
        }

        function editItem(index) {
            isNewItem = false;
            selectedItem = filteredItems[index];
            showDetail();
        }

        function showDetail() {
            document.getElementById('detailPanel').classList.remove('hidden');
            document.getElementById('detailPanel').classList.add('visible');

            if (selectedItem) {
                document.getElementById('detailTitle').textContent = 'Edit Item';
                document.getElementById('detailKey').value = selectedItem.key;
                document.getElementById('detailKey').disabled = !isNewItem;
                
                // Try to format JSON
                let displayValue = selectedItem.value;
                try {
                    const parsed = JSON.parse(selectedItem.value);
                    displayValue = JSON.stringify(parsed, null, 2);
                } catch {}
                
                document.getElementById('detailValue').value = displayValue;
                document.getElementById('detailType').innerHTML = `<span class="type-badge ${getValueType(selectedItem.value)}">${getValueType(selectedItem.value)}</span>`;
                document.getElementById('detailSize').textContent = formatBytes(getByteSize(selectedItem.value));
                document.getElementById('detailCategory').textContent = selectedItem.category.charAt(0).toUpperCase() + selectedItem.category.slice(1);
                document.getElementById('detailCreated').textContent = formatTimeAgo(selectedItem.created);
                document.getElementById('deleteBtn').style.display = 'block';

                // Show JSON preview if applicable
                const type = getValueType(selectedItem.value);
                if (type === 'object' || type === 'array') {
                    document.getElementById('jsonPreview').style.display = 'block';
                    try {
                        document.getElementById('jsonViewer').innerHTML = formatJSON(JSON.parse(selectedItem.value));
                    } catch {
                        document.getElementById('jsonPreview').style.display = 'none';
                    }
                } else {
                    document.getElementById('jsonPreview').style.display = 'none';
                }
            }
        }

        function formatJSON(obj, indent = 0) {
            if (obj === null) return '<span class="json-null">null</span>';
            if (typeof obj !== 'object') {
                if (typeof obj === 'string') return `<span class="json-string">"${escapeHtml(obj)}"</span>`;
                if (typeof obj === 'number') return `<span class="json-number">${obj}</span>`;
                if (typeof obj === 'boolean') return `<span class="json-boolean">${obj}</span>`;
            }

            const isArray = Array.isArray(obj);
            const entries = Object.entries(obj);
            const spaces = '  '.repeat(indent);
            const innerSpaces = '  '.repeat(indent + 1);

            if (entries.length === 0) return isArray ? '[]' : '{}';

            let html = `${isArray ? '[' : '{'}<br>`;
            entries.forEach(([key, value], i) => {
                const comma = i < entries.length - 1 ? ',' : '';
                const keyStr = isArray ? '' : `<span class="json-key">"${escapeHtml(key)}"</span>: `;
                html += `${innerSpaces}${keyStr}${formatJSON(value, indent + 1)}${comma}<br>`;
            });
            html += `${spaces}${isArray ? ']' : '}'}`;
            return html;
        }

        function closeDetail() {
            document.getElementById('detailPanel').classList.add('hidden');
            document.getElementById('detailPanel').classList.remove('visible');
            selectedItem = null;
            isNewItem = false;
            renderTable();
        }

        function addItem() {
            isNewItem = true;
            selectedItem = { key: '', value: '', category: 'temp', created: Date.now() };
            document.getElementById('detailTitle').textContent = 'Add New Item';
            document.getElementById('detailKey').value = '';
            document.getElementById('detailKey').disabled = false;
            document.getElementById('detailValue').value = '';
            document.getElementById('detailType').textContent = '--';
            document.getElementById('detailSize').textContent = '--';
            document.getElementById('detailCategory').textContent = 'Temp';
            document.getElementById('detailCreated').textContent = 'Now';
            document.getElementById('deleteBtn').style.display = 'none';
            document.getElementById('jsonPreview').style.display = 'none';
            document.getElementById('detailPanel').classList.remove('hidden');
        }

        function saveItem() {
            const key = document.getElementById('detailKey').value.trim();
            let value = document.getElementById('detailValue').value;

            if (!key) {
                alert('Please enter a key');
                return;
            }

            // Try to minify JSON if valid
            try {
                const parsed = JSON.parse(value);
                value = JSON.stringify(parsed);
            } catch {}

            if (isNewItem) {
                if (storageItems.some(item => item.key === key)) {
                    alert('Key already exists');
                    return;
                }
                storageItems.push({ key, value, category: 'temp', created: Date.now() });
            } else {
                const item = storageItems.find(i => i.key === selectedItem.key);
                if (item) {
                    item.value = value;
                }
            }

            filterItems();
            closeDetail();
        }

        function deleteItem() {
            if (confirm(`Delete "${selectedItem.key}"?`)) {
                storageItems = storageItems.filter(i => i.key !== selectedItem.key);
                filterItems();
                closeDetail();
            }
        }

        function deleteItemByIndex(index) {
            const item = filteredItems[index];
            if (confirm(`Delete "${item.key}"?`)) {
                storageItems = storageItems.filter(i => i.key !== item.key);
                filterItems();
            }
        }

        function copyValue(index) {
            const item = filteredItems[index];
            navigator.clipboard.writeText(item.value);
        }

        // Toolbar actions
        function refreshData() {
            document.getElementById('lastRefresh').textContent = new Date().toLocaleTimeString();
            renderTable();
        }

        function exportData() {
            const data = {};
            storageItems.forEach(item => data[item.key] = item.value);
            console.log('SessionStorage Export:', data);
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            console.log('Download URL:', url);
            alert('Session data exported to console.\nIn production, this would download a JSON file.');
        }

        function clearAll() {
            if (confirm('Clear ALL session storage items? This cannot be undone.')) {
                storageItems = [];
                filterItems();
            }
        }

        // Generate tab ID
        function generateTabId() {
            return 'tab_' + Math.random().toString(36).substring(2, 8);
        }

        // Initialize
        document.getElementById('tabId').textContent = generateTabId();
        renderTable();
        updateSessionTimer();
        document.getElementById('lastRefresh').textContent = new Date().toLocaleTimeString();
    </script>
</body>
</html>
